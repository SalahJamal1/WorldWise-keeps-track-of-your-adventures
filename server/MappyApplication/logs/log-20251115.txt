2025-11-15 03:42:46.857 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE `mappy_db`;
2025-11-15 03:42:46.949 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `__EFMigrationsHistory` (
    `MigrationId` varchar(150) CHARACTER SET utf8mb4 NOT NULL,
    `ProductVersion` varchar(32) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK___EFMigrationsHistory` PRIMARY KEY (`MigrationId`)
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:46.969 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mappy_db' AND TABLE_NAME='__EFMigrationsHistory';
2025-11-15 03:42:46.976 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-11-15 03:42:46.981 +03:00 [INF] Applying migration '20251115004230_createTable'.
2025-11-15 03:42:47.003 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER DATABASE CHARACTER SET utf8mb4;
2025-11-15 03:42:47.019 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetRoles` (
    `Id` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Name` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `ConcurrencyStamp` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetRoles` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.027 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUsers` (
    `Id` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `FirstName` longtext CHARACTER SET utf8mb4 NOT NULL,
    `LastName` longtext CHARACTER SET utf8mb4 NOT NULL,
    `UserName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedUserName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `Email` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedEmail` varchar(256) CHARACTER SET utf8mb4 NULL,
    `EmailConfirmed` tinyint(1) NOT NULL,
    `PasswordHash` longtext CHARACTER SET utf8mb4 NULL,
    `SecurityStamp` longtext CHARACTER SET utf8mb4 NULL,
    `ConcurrencyStamp` longtext CHARACTER SET utf8mb4 NULL,
    `PhoneNumber` longtext CHARACTER SET utf8mb4 NULL,
    `PhoneNumberConfirmed` tinyint(1) NOT NULL,
    `TwoFactorEnabled` tinyint(1) NOT NULL,
    `LockoutEnd` datetime(6) NULL,
    `LockoutEnabled` tinyint(1) NOT NULL,
    `AccessFailedCount` int NOT NULL,
    CONSTRAINT `PK_AspNetUsers` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.036 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Tokens` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `AccessToken` longtext CHARACTER SET utf8mb4 NOT NULL,
    `RefreshToken` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Revoked` tinyint(1) NOT NULL,
    `Expired` tinyint(1) NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `DeviceId` longtext CHARACTER SET utf8mb4 NOT NULL,
    `UserId` longtext CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_Tokens` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.040 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetRoleClaims` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `RoleId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ClaimType` longtext CHARACTER SET utf8mb4 NULL,
    `ClaimValue` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetRoleClaims` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_AspNetRoleClaims_AspNetRoles_RoleId` FOREIGN KEY (`RoleId`) REFERENCES `AspNetRoles` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.047 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserClaims` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ClaimType` longtext CHARACTER SET utf8mb4 NULL,
    `ClaimValue` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetUserClaims` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_AspNetUserClaims_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.051 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserLogins` (
    `LoginProvider` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ProviderKey` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ProviderDisplayName` longtext CHARACTER SET utf8mb4 NULL,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_AspNetUserLogins` PRIMARY KEY (`LoginProvider`, `ProviderKey`),
    CONSTRAINT `FK_AspNetUserLogins_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.055 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserRoles` (
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `RoleId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_AspNetUserRoles` PRIMARY KEY (`UserId`, `RoleId`),
    CONSTRAINT `FK_AspNetUserRoles_AspNetRoles_RoleId` FOREIGN KEY (`RoleId`) REFERENCES `AspNetRoles` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_AspNetUserRoles_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.059 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserTokens` (
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `LoginProvider` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Name` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Value` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetUserTokens` PRIMARY KEY (`UserId`, `LoginProvider`, `Name`),
    CONSTRAINT `FK_AspNetUserTokens_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 03:42:47.062 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetRoles` (`Id`, `ConcurrencyStamp`, `Name`, `NormalizedName`)
VALUES ('3b6b1389-ee24-49d0-aa50-62cd73d7ac18', NULL, 'user', 'USER'),
('ef6d7c90-f563-4d7c-9a01-02121fa05bfa', NULL, 'admin', 'ADMIN');
2025-11-15 03:42:47.082 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetRoleClaims_RoleId` ON `AspNetRoleClaims` (`RoleId`);
2025-11-15 03:42:47.092 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `RoleNameIndex` ON `AspNetRoles` (`NormalizedName`);
2025-11-15 03:42:47.096 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserClaims_UserId` ON `AspNetUserClaims` (`UserId`);
2025-11-15 03:42:47.098 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserLogins_UserId` ON `AspNetUserLogins` (`UserId`);
2025-11-15 03:42:47.100 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserRoles_RoleId` ON `AspNetUserRoles` (`RoleId`);
2025-11-15 03:42:47.109 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `EmailIndex` ON `AspNetUsers` (`NormalizedEmail`);
2025-11-15 03:42:47.118 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `IX_AspNetUsers_Email` ON `AspNetUsers` (`Email`);
2025-11-15 03:42:47.124 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `UserNameIndex` ON `AspNetUsers` (`NormalizedUserName`);
2025-11-15 03:42:47.125 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20251115004230_createTable', '8.0.18');
2025-11-15 03:43:00.155 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:43:00.201 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:43:00.202 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:43:00.202 +03:00 [INF] Hosting environment: Development
2025-11-15 03:43:00.202 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:43:07.013 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 164
2025-11-15 03:43:07.035 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:43:07.056 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:43:07.072 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:43:07.103 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 29.0953ms
2025-11-15 03:43:07.104 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:43:07.104 +03:00 [ERR] An error occured
System.NullReferenceException: Object reference not set to an instance of an object.
   at MappyApplication.Controllers.AuthController.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 19
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:43:07.116 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 500 null application/json; charset=utf-8 104.1383ms
2025-11-15 03:45:10.556 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 164
2025-11-15 03:45:10.572 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:45:10.576 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:45:10.581 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 5.5419ms
2025-11-15 03:45:10.582 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:45:10.582 +03:00 [ERR] An error occured
System.NullReferenceException: Object reference not set to an instance of an object.
   at MappyApplication.Controllers.AuthController.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 19
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:45:10.586 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 500 null application/json; charset=utf-8 31.5088ms
2025-11-15 03:45:11.458 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 164
2025-11-15 03:45:11.464 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:45:11.465 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:45:11.466 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 1.0897ms
2025-11-15 03:45:11.466 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:45:11.467 +03:00 [ERR] An error occured
System.NullReferenceException: Object reference not set to an instance of an object.
   at MappyApplication.Controllers.AuthController.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 19
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:45:11.468 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 500 null application/json; charset=utf-8 10.5788ms
2025-11-15 03:45:14.411 +03:00 [INF] Application is shutting down...
2025-11-15 03:45:18.189 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:45:18.244 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:45:18.245 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:45:18.245 +03:00 [INF] Hosting environment: Development
2025-11-15 03:45:18.245 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:45:24.539 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 164
2025-11-15 03:45:24.556 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:45:24.573 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:45:24.585 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:45:25.146 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:45:25.194 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedUserName` = @__normalizedUserName_0
LIMIT 1
2025-11-15 03:45:25.196 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:45:25.263 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Size = 256), @p4='?' (DbType = Boolean), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Boolean), @p8='?' (DbType = DateTimeOffset), @p9='?' (Size = 256), @p10='?' (Size = 256), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 4000), @p15='?' (DbType = Boolean), @p16='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetUsers` (`Id`, `AccessFailedCount`, `ConcurrencyStamp`, `Email`, `EmailConfirmed`, `FirstName`, `LastName`, `LockoutEnabled`, `LockoutEnd`, `NormalizedEmail`, `NormalizedUserName`, `PasswordHash`, `PhoneNumber`, `PhoneNumberConfirmed`, `SecurityStamp`, `TwoFactorEnabled`, `UserName`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
2025-11-15 03:45:25.272 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-11-15 03:45:25.300 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (Size = 255), @__p_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`UserId`, `a`.`RoleId`
FROM `AspNetUserRoles` AS `a`
WHERE (`a`.`UserId` = @__p_0) AND (`a`.`RoleId` = @__p_1)
LIMIT 1
2025-11-15 03:45:25.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-11-15 03:45:25.307 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedUserName` = @__normalizedUserName_0
LIMIT 1
2025-11-15 03:45:25.308 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:45:25.326 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 255), @p18='?' (Size = 255), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p19='?' (Size = 4000), @p4='?' (Size = 256), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTimeOffset), @p10='?' (Size = 256), @p11='?' (Size = 256), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetUserRoles` (`RoleId`, `UserId`)
VALUES (@p0, @p1);
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p2, `ConcurrencyStamp` = @p3, `Email` = @p4, `EmailConfirmed` = @p5, `FirstName` = @p6, `LastName` = @p7, `LockoutEnabled` = @p8, `LockoutEnd` = @p9, `NormalizedEmail` = @p10, `NormalizedUserName` = @p11, `PasswordHash` = @p12, `PhoneNumber` = @p13, `PhoneNumberConfirmed` = @p14, `SecurityStamp` = @p15, `TwoFactorEnabled` = @p16, `UserName` = @p17
WHERE `Id` = @p18 AND `ConcurrencyStamp` = @p19;
SELECT ROW_COUNT();
2025-11-15 03:45:25.336 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=true, Expired=true WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=false AND Expired=false)
2025-11-15 03:45:25.337 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 50
2025-11-15 03:45:25.346 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 759.9558ms
2025-11-15 03:45:25.347 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:45:25.347 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MappyApplication.Repository.AuthManager.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 55
   at MappyApplication.Controllers.AuthController.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 24
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:45:25.359 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 400 null application/json; charset=utf-8 820.3541ms
2025-11-15 03:47:05.109 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:47:05.121 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:05.130 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:47:05.235 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:47:05.275 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=true, Expired=true WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=false AND Expired=false)
2025-11-15 03:47:05.276 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:47:05.277 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 146.928ms
2025-11-15 03:47:05.277 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:05.277 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method300(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:47:05.278 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 169.7974ms
2025-11-15 03:47:06.290 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:47:06.294 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:06.294 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:47:06.334 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:47:06.387 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=true, Expired=true WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=false AND Expired=false)
2025-11-15 03:47:06.387 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:47:06.388 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 93.915ms
2025-11-15 03:47:06.389 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:06.389 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method300(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:47:06.389 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 99.421ms
2025-11-15 03:47:07.155 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:47:07.156 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:07.157 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:47:07.181 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:47:07.234 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=true, Expired=true WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=false AND Expired=false)
2025-11-15 03:47:07.235 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:47:07.236 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 78.7113ms
2025-11-15 03:47:07.236 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:07.236 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method300(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:47:07.236 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 81.0673ms
2025-11-15 03:47:07.839 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:47:07.839 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:07.840 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:47:07.874 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:47:07.922 +03:00 [ERR] Failed executing DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=true, Expired=true WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=false AND Expired=false)
2025-11-15 03:47:07.923 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:47:07.924 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 83.7552ms
2025-11-15 03:47:07.924 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:07.924 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method300(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:47:07.924 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 85.6057ms
2025-11-15 03:47:08.652 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:47:08.653 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:08.653 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:47:08.679 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:47:08.731 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=true, Expired=true WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=false AND Expired=false)
2025-11-15 03:47:08.731 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:47:08.732 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 79.3363ms
2025-11-15 03:47:08.733 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:08.733 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=false AND Expired=false)' at line 1
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method300(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:47:08.734 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 81.8406ms
2025-11-15 03:47:46.266 +03:00 [INF] Application is shutting down...
2025-11-15 03:47:50.002 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:47:50.049 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:47:50.050 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:47:50.050 +03:00 [INF] Hosting environment: Development
2025-11-15 03:47:50.050 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:47:57.937 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:47:57.954 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:47:57.972 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:57.986 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:47:58.498 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:47:58.563 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

UPDATE TOKENS SET Revoked=TRUE, Expired=TRUE WHERE UserId=@p0 AND DeviceId=@p1 (Revoked=FALSE AND Expired=FALSE)
2025-11-15 03:47:58.564 +03:00 [ERR] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=FALSE AND Expired=FALSE)' at line 1
MySqlConnector.MySqlException (0x80004005): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=FALSE AND Expired=FALSE)' at line 1
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at MappyApplication.Repository.TokenRepository.UpdateAllValidTokenByUserIdAndDeviceId(String userId, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 23
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 109
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:47:58.572 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 585.6382ms
2025-11-15 03:47:58.573 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:47:58.573 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(Revoked=FALSE AND Expired=FALSE)' at line 1
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:47:58.585 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 649.4532ms
2025-11-15 03:49:07.413 +03:00 [INF] Application is shutting down...
2025-11-15 03:49:10.800 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:49:10.846 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:49:10.847 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:49:10.847 +03:00 [INF] Hosting environment: Development
2025-11-15 03:49:10.847 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:49:17.337 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:49:17.358 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:49:17.384 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:49:17.396 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:49:17.926 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:49:18.006 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:49:18.028 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:49:18.036 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:49:18.046 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:49:18.047 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:49:18.097 +03:00 [ERR] Failed executing DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:49:18.110 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'MappyApplication.Data.MappyDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'DeviceId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'DeviceId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-11-15 03:49:18.113 +03:00 [ERR] An error occurred while saving the entity changes. See the inner exception for details.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Column 'DeviceId' cannot be null
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MappyApplication.Repository.GenricRepository`1.AddAsync(T e) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/GenricRepository.cs:line 54
   at MappyApplication.Repository.AuthManager.GetResponse(User user, String deviceId) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 119
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 67
2025-11-15 03:49:18.117 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 719.9767ms
2025-11-15 03:49:18.118 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:49:18.118 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: An error occurred while saving the entity changes. See the inner exception for details.
   at MappyApplication.Repository.AuthManager.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 72
   at MappyApplication.Controllers.AuthController.Login(AuthLogin authLogin) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 32
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:49:18.128 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 400 null application/json; charset=utf-8 792.6007ms
2025-11-15 03:51:04.803 +03:00 [INF] Application is shutting down...
2025-11-15 03:51:07.771 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:51:07.820 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:51:07.821 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:51:07.821 +03:00 [INF] Hosting environment: Development
2025-11-15 03:51:07.821 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:51:10.853 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:51:10.869 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:51:10.887 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:10.897 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:51:11.436 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:51:11.505 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:51:11.526 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:11.531 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:11.542 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:11.542 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:11.630 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:51:11.713 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:51:11.719 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:51:11.727 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 828.0569ms
2025-11-15 03:51:11.727 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:11.730 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 878.384ms
2025-11-15 03:51:13.773 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:51:13.779 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:13.779 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:51:13.838 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:51:13.884 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:51:13.886 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:13.887 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:13.888 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:13.889 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:13.892 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:51:13.893 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:51:13.893 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:51:13.894 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 113.9354ms
2025-11-15 03:51:13.894 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:13.894 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 120.9683ms
2025-11-15 03:51:14.677 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:51:14.684 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:14.685 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:51:14.924 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:51:14.965 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:51:14.967 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:14.968 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:14.970 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:14.971 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:14.977 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:51:14.978 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:51:14.979 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:51:14.979 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 83.1201ms
2025-11-15 03:51:14.979 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:14.979 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 302.4587ms
2025-11-15 03:51:23.185 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:51:23.194 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:51:23.209 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:51:23.209 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 24.1264ms
2025-11-15 03:51:24.471 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:51:24.474 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:51:24.475 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:51:24.475 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 4.6591ms
2025-11-15 03:51:25.256 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:51:25.258 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:51:25.259 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:51:25.259 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 3.4535ms
2025-11-15 03:51:26.343 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:51:26.344 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:51:26.344 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:51:26.344 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.1769ms
2025-11-15 03:51:27.004 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:51:27.004 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:51:27.005 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:51:27.005 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.5939ms
2025-11-15 03:51:33.973 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:51:33.974 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:51:33.974 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:51:33.974 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.1172ms
2025-11-15 03:51:37.120 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 03:51:37.121 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:37.122 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:51:37.176 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:51:37.227 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:51:37.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:37.231 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:37.232 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:51:37.232 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:51:37.236 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:51:37.237 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:51:37.237 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:51:37.238 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 115.3554ms
2025-11-15 03:51:37.238 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:51:37.238 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 118.2095ms
2025-11-15 03:52:14.488 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:14.492 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:14.492 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:14.495 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 4.4097ms
2025-11-15 03:52:15.431 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:15.432 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:15.432 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:15.432 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.2805ms
2025-11-15 03:52:15.934 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:15.934 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:15.935 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:15.935 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.7142ms
2025-11-15 03:52:16.379 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:16.379 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:16.380 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:16.380 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 0.9908ms
2025-11-15 03:52:16.864 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:16.865 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:16.865 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:16.865 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 0.8477ms
2025-11-15 03:52:17.368 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:17.368 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:17.369 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:17.369 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.3448ms
2025-11-15 03:52:17.847 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:17.848 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:17.848 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:17.848 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 0.9871ms
2025-11-15 03:52:18.326 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:52:18.327 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 03:52:18.327 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 03:52:18.327 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.4281ms
2025-11-15 03:52:26.115 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 163
2025-11-15 03:52:26.116 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:52:26.128 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:52:26.167 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:52:26.226 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedUserName` = @__normalizedUserName_0
LIMIT 1
2025-11-15 03:52:26.228 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:52:26.241 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Size = 256), @p4='?' (DbType = Boolean), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Boolean), @p8='?' (DbType = DateTimeOffset), @p9='?' (Size = 256), @p10='?' (Size = 256), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 4000), @p15='?' (DbType = Boolean), @p16='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetUsers` (`Id`, `AccessFailedCount`, `ConcurrencyStamp`, `Email`, `EmailConfirmed`, `FirstName`, `LastName`, `LockoutEnabled`, `LockoutEnd`, `NormalizedEmail`, `NormalizedUserName`, `PasswordHash`, `PhoneNumber`, `PhoneNumberConfirmed`, `SecurityStamp`, `TwoFactorEnabled`, `UserName`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
2025-11-15 03:52:26.248 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-11-15 03:52:26.260 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255), @__p_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`UserId`, `a`.`RoleId`
FROM `AspNetUserRoles` AS `a`
WHERE (`a`.`UserId` = @__p_0) AND (`a`.`RoleId` = @__p_1)
LIMIT 1
2025-11-15 03:52:26.263 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-11-15 03:52:26.267 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedUserName` = @__normalizedUserName_0
LIMIT 1
2025-11-15 03:52:26.268 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:52:26.280 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 255), @p18='?' (Size = 255), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p19='?' (Size = 4000), @p4='?' (Size = 256), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTimeOffset), @p10='?' (Size = 256), @p11='?' (Size = 256), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetUserRoles` (`RoleId`, `UserId`)
VALUES (@p0, @p1);
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p2, `ConcurrencyStamp` = @p3, `Email` = @p4, `EmailConfirmed` = @p5, `FirstName` = @p6, `LastName` = @p7, `LockoutEnabled` = @p8, `LockoutEnd` = @p9, `NormalizedEmail` = @p10, `NormalizedUserName` = @p11, `PasswordHash` = @p12, `PhoneNumber` = @p13, `PhoneNumberConfirmed` = @p14, `SecurityStamp` = @p15, `TwoFactorEnabled` = @p16, `UserName` = @p17
WHERE `Id` = @p18 AND `ConcurrencyStamp` = @p19;
SELECT ROW_COUNT();
2025-11-15 03:52:26.282 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:52:26.283 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:52:26.284 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:52:26.285 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:52:26.286 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:52:26.289 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:52:26.290 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:52:26.290 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:52:26.290 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 161.683ms
2025-11-15 03:52:26.290 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:52:26.290 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 200 null application/json; charset=utf-8 175.0382ms
2025-11-15 03:52:29.439 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 163
2025-11-15 03:52:29.441 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:52:29.441 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:52:29.468 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:52:29.469 +03:00 [ERR] Email address already exists
MappyApplication.Exceptions.AppErrorResponse: Email address already exists
   at MappyApplication.Repository.AuthManager.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 42
2025-11-15 03:52:29.476 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 35.1522ms
2025-11-15 03:52:29.477 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 03:52:29.477 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Email address already exists
   at MappyApplication.Repository.AuthManager.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 55
   at MappyApplication.Controllers.AuthController.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 24
   at lambda_method316(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:52:29.480 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 400 null application/json; charset=utf-8 41.0319ms
2025-11-15 03:52:34.611 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 03:52:34.614 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:52:34.615 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:52:34.644 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:52:34.694 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:52:34.695 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:52:34.696 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:52:34.696 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:52:34.697 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:52:34.699 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:52:34.700 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:52:34.700 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:52:34.700 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 85.5127ms
2025-11-15 03:52:34.701 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:52:34.701 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 89.6413ms
2025-11-15 03:52:54.429 +03:00 [INF] Application is shutting down...
2025-11-15 03:52:57.976 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:52:58.027 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:52:58.028 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:52:58.028 +03:00 [INF] Hosting environment: Development
2025-11-15 03:52:58.028 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:53:01.266 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 03:53:01.282 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:53:01.302 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:53:01.314 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:53:01.820 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:53:01.889 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:53:01.909 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:53:01.915 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:53:01.926 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:53:01.927 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:53:01.973 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:53:01.984 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:53:01.988 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:53:01.996 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 681.3344ms
2025-11-15 03:53:01.997 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:53:02.000 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 734.2871ms
2025-11-15 03:53:05.631 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:53:05.641 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:53:05.650 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:53:05.708 +03:00 [ERR] The key value at position 0 of the call to 'DbSet<Token>.Find' was of type 'string', which does not match the property type of 'int'.
System.ArgumentException: The key value at position 0 of the call to 'DbSet<Token>.Find' was of type 'string', which does not match the property type of 'int'.
   at Microsoft.EntityFrameworkCore.Internal.EntityFinder`1.FindTracked(Object[] keyValues)
   at Microsoft.EntityFrameworkCore.Internal.EntityFinder`1.FindAsync(Object[] keyValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.FindAsync(Object[] keyValues)
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 35
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 03:53:05.714 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 63.6444ms
2025-11-15 03:53:05.714 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:53:05.714 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: The key value at position 0 of the call to 'DbSet<Token>.Find' was of type 'string', which does not match the property type of 'int'.
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 92
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method316(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:53:05.724 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 92.8729ms
2025-11-15 03:53:12.360 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:53:12.371 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:53:12.371 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:53:12.417 +03:00 [ERR] The key value at position 0 of the call to 'DbSet<Token>.Find' was of type 'string', which does not match the property type of 'int'.
System.ArgumentException: The key value at position 0 of the call to 'DbSet<Token>.Find' was of type 'string', which does not match the property type of 'int'.
   at Microsoft.EntityFrameworkCore.Internal.EntityFinder`1.FindTracked(Object[] keyValues)
   at Microsoft.EntityFrameworkCore.Internal.EntityFinder`1.FindAsync(Object[] keyValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.FindAsync(Object[] keyValues)
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 35
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 03:53:12.419 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 46.5954ms
2025-11-15 03:53:12.419 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:53:12.419 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: The key value at position 0 of the call to 'DbSet<Token>.Find' was of type 'string', which does not match the property type of 'int'.
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 92
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method316(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:53:12.420 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 60.6814ms
2025-11-15 03:56:08.956 +03:00 [INF] Application is shutting down...
2025-11-15 03:56:12.162 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:56:12.211 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:56:12.212 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:56:12.212 +03:00 [INF] Hosting environment: Development
2025-11-15 03:56:12.212 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:56:20.595 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:56:20.612 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:56:20.629 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:56:20.641 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:56:21.148 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:56:21.188 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:56:21.206 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 86
2025-11-15 03:56:21.210 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 568.3001ms
2025-11-15 03:56:21.211 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:56:21.211 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 92
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:56:21.237 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 643.7467ms
2025-11-15 03:56:22.768 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:56:22.774 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:56:22.775 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:56:22.812 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:56:22.814 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:56:22.814 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 86
2025-11-15 03:56:22.815 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 39.8104ms
2025-11-15 03:56:22.815 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:56:22.816 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 92
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:56:22.817 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 49.3692ms
2025-11-15 03:56:25.679 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 03:56:25.687 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:56:25.715 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:56:25.812 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:56:25.858 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:56:25.879 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:56:25.886 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:56:25.894 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:56:25.895 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:56:25.950 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:56:25.963 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:56:25.967 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:56:25.968 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 251.8475ms
2025-11-15 03:56:25.968 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:56:25.968 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 289.3764ms
2025-11-15 03:56:28.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:56:28.770 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:56:28.770 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:56:28.804 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:56:28.806 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:56:28.807 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 86
2025-11-15 03:56:28.807 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 36.9056ms
2025-11-15 03:56:28.808 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:56:28.808 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 92
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:56:28.809 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 39.6634ms
2025-11-15 03:56:31.500 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 03:56:31.501 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:56:31.501 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:56:31.522 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:56:31.578 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:56:31.579 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:56:31.580 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:56:31.581 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:56:31.581 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:56:31.584 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:56:31.585 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:56:31.585 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:56:31.586 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 84.2256ms
2025-11-15 03:56:31.586 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:56:31.586 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 85.8536ms
2025-11-15 03:57:01.203 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 03:57:01.211 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:57:01.212 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:57:01.289 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 03:57:01.338 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 03:57:01.341 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:57:01.342 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:57:01.344 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 03:57:01.344 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 03:57:01.348 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 03:57:01.349 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 03:57:01.350 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 03:57:01.350 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 137.603ms
2025-11-15 03:57:01.350 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 03:57:01.350 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 147.548ms
2025-11-15 03:57:04.541 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:57:04.542 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:57:04.542 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:57:04.568 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:57:04.569 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:57:04.570 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 86
2025-11-15 03:57:04.571 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 28.2463ms
2025-11-15 03:57:04.571 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:57:04.571 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 92
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:57:04.572 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 30.8772ms
2025-11-15 03:58:09.199 +03:00 [INF] Application is shutting down...
2025-11-15 03:58:12.205 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:58:12.249 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:58:12.250 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:58:12.251 +03:00 [INF] Hosting environment: Development
2025-11-15 03:58:12.251 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:58:15.534 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:58:15.551 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:58:15.571 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:58:15.582 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:58:16.021 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:58:16.060 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:58:16.078 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 87
2025-11-15 03:58:16.082 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 498.5067ms
2025-11-15 03:58:16.083 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:58:16.083 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:58:16.108 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 574.553ms
2025-11-15 03:58:46.750 +03:00 [INF] Application is shutting down...
2025-11-15 03:58:49.317 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:58:49.362 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:58:49.363 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:58:49.363 +03:00 [INF] Hosting environment: Development
2025-11-15 03:58:49.363 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:58:53.070 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:58:53.087 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:58:53.100 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:58:53.110 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:58:53.554 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:58:53.592 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:58:53.611 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 87
2025-11-15 03:58:53.617 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 504.965ms
2025-11-15 03:58:53.617 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:58:53.617 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:58:53.643 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 574.0429ms
2025-11-15 03:59:19.718 +03:00 [INF] Application is shutting down...
2025-11-15 03:59:22.125 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 03:59:22.171 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 03:59:22.172 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 03:59:22.172 +03:00 [INF] Hosting environment: Development
2025-11-15 03:59:22.172 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 03:59:23.870 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:59:23.890 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 03:59:23.902 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:59:23.912 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:59:24.387 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:59:24.425 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:59:24.443 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 87
2025-11-15 03:59:24.447 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 533.3343ms
2025-11-15 03:59:24.448 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:59:24.448 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:59:24.472 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 603.425ms
2025-11-15 03:59:59.578 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 03:59:59.594 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:59:59.596 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 03:59:59.638 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 03:59:59.644 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 03:59:59.645 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 87
2025-11-15 03:59:59.646 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 49.3208ms
2025-11-15 03:59:59.646 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 03:59:59.646 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 03:59:59.648 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 70.6926ms
2025-11-15 04:00:07.557 +03:00 [INF] Application is shutting down...
2025-11-15 04:00:10.593 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:00:10.638 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:00:10.639 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:00:10.639 +03:00 [INF] Hosting environment: Development
2025-11-15 04:00:10.639 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:00:13.473 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:00:13.488 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:00:13.499 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:13.508 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:00:13.939 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:00:13.975 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:00:13.992 +03:00 [ERR] you are not logged in
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 87
2025-11-15 04:00:13.997 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 486.8729ms
2025-11-15 04:00:13.997 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:13.997 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: you are not logged in
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:00:14.022 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 549.3444ms
2025-11-15 04:00:47.395 +03:00 [INF] Application is shutting down...
2025-11-15 04:00:50.112 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:00:50.173 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:00:50.176 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:00:50.176 +03:00 [INF] Hosting environment: Development
2025-11-15 04:00:50.176 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:00:51.384 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:00:51.402 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:00:51.417 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:51.426 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:00:51.957 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:00:51.998 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:00:52.024 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:00:52.046 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:52.051 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:52.061 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:52.062 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:52.118 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:00:52.132 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:00:52.136 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:00:52.157 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 729.7089ms
2025-11-15 04:00:52.157 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:52.160 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 777.0091ms
2025-11-15 04:00:52.967 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:00:52.972 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:52.973 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:00:53.002 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:00:53.004 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:00:53.006 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:00:53.008 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:53.010 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:53.011 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:53.012 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:53.015 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:00:53.016 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:00:53.017 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:00:53.017 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 43.8333ms
2025-11-15 04:00:53.017 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:53.018 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 50.301ms
2025-11-15 04:00:53.690 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:00:53.695 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:53.696 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:00:53.750 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:00:53.751 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:00:53.754 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:00:53.755 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:53.757 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:53.757 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:53.758 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:53.759 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:00:53.760 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:00:53.761 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:00:53.761 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 64.7421ms
2025-11-15 04:00:53.761 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:53.761 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 71.34ms
2025-11-15 04:00:54.228 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:00:54.229 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:54.229 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:00:54.241 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:00:54.243 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:00:54.244 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:00:54.245 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:54.246 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:54.247 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:54.248 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:54.251 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:00:54.252 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:00:54.252 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:00:54.252 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 23.1583ms
2025-11-15 04:00:54.252 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:54.252 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 23.8756ms
2025-11-15 04:00:54.912 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:00:54.917 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:54.920 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:00:55.181 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:00:55.182 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:00:55.184 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:00:55.186 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:55.186 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:55.187 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:00:55.188 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:00:55.192 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:00:55.194 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:00:55.194 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:00:55.194 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 33.6728ms
2025-11-15 04:00:55.194 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:00:55.194 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 282.5927ms
2025-11-15 04:00:57.791 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:00:57.807 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:00:57.819 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:00:57.819 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 28.7582ms
2025-11-15 04:00:59.262 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:00:59.266 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:00:59.266 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:00:59.267 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 4.3145ms
2025-11-15 04:01:00.129 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:00.130 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:01:00.131 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:01:00.131 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 2.2112ms
2025-11-15 04:01:00.774 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:00.774 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:01:00.776 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:01:00.776 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 2.2192ms
2025-11-15 04:01:01.290 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:01.291 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:01:01.291 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:01:01.292 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 1.3347ms
2025-11-15 04:01:32.026 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:01:32.030 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:01:32.055 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:32.149 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:01:32.187 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:01:32.188 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:01:32.189 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:01:32.190 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:01:32.191 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:01:32.194 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:01:32.196 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:01:32.196 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:01:32.196 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 141.3192ms
2025-11-15 04:01:32.196 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:01:32.196 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 171.2475ms
2025-11-15 04:01:49.543 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:49.590 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:49.598 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:49.634 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:01:49.637 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:01:49.640 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:01:49.649 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 50.3238ms
2025-11-15 04:01:49.649 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:49.649 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 106.8318ms
2025-11-15 04:01:53.086 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:53.087 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:53.087 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:53.111 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:01:53.113 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 25.7818ms
2025-11-15 04:01:53.113 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:53.114 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:01:53.125 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 39.431ms
2025-11-15 04:01:54.608 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:54.611 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:54.611 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:54.632 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:01:54.633 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 21.7632ms
2025-11-15 04:01:54.633 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:54.634 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:01:54.635 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 27.6452ms
2025-11-15 04:01:55.327 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:55.328 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:55.328 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:55.351 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:01:55.352 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 23.5323ms
2025-11-15 04:01:55.352 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:55.352 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:01:55.354 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 27.1527ms
2025-11-15 04:01:55.876 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:55.877 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:55.877 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:55.900 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:01:55.901 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 23.9315ms
2025-11-15 04:01:55.901 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:55.901 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:01:55.902 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 26.4224ms
2025-11-15 04:01:56.425 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:56.426 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:56.426 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:56.451 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:01:56.452 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 25.759ms
2025-11-15 04:01:56.453 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:56.453 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:01:56.454 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 29.4512ms
2025-11-15 04:01:57.012 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:01:57.012 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:57.013 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:01:57.035 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:01:57.035 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 22.5614ms
2025-11-15 04:01:57.036 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:01:57.036 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:01:57.037 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 25.0705ms
2025-11-15 04:02:27.360 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:02:27.362 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:02:27.363 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:02:27.401 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:02:27.455 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:02:27.457 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:02:27.458 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:02:27.458 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:02:27.459 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:02:27.462 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:02:27.464 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:02:27.464 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:02:27.464 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 101.374ms
2025-11-15 04:02:27.464 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:02:27.465 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 104.205ms
2025-11-15 04:02:39.618 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:02:39.620 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:39.620 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:02:39.657 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:02:39.658 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:02:39.659 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:02:39.660 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 38.7833ms
2025-11-15 04:02:39.660 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:39.660 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 41.9341ms
2025-11-15 04:02:42.940 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:02:42.943 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:42.943 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:02:42.967 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:02:42.968 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 24.9681ms
2025-11-15 04:02:42.968 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:42.969 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:02:42.969 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 28.8707ms
2025-11-15 04:02:44.707 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:02:44.709 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:44.710 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:02:44.736 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:02:44.737 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 27.2372ms
2025-11-15 04:02:44.737 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:44.737 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:02:44.738 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 31.0547ms
2025-11-15 04:02:45.264 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:02:45.265 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:45.266 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:02:45.289 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:02:45.289 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 23.5406ms
2025-11-15 04:02:45.290 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:02:45.290 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:02:45.291 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 27.1651ms
2025-11-15 04:05:45.867 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:05:45.871 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:45.871 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:05:45.913 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:05:45.914 +03:00 [ERR] No token
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:05:45.916 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 44.2935ms
2025-11-15 04:05:45.916 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:45.916 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:05:45.920 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 53.8944ms
2025-11-15 04:05:47.394 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:05:47.396 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:47.396 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:05:47.422 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:05:47.422 +03:00 [ERR] No token
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:05:47.423 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 26.3295ms
2025-11-15 04:05:47.423 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:47.423 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:05:47.424 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 29.6705ms
2025-11-15 04:05:48.117 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:05:48.118 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:48.118 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:05:48.142 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:05:48.143 +03:00 [ERR] No token
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:05:48.144 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 24.8575ms
2025-11-15 04:05:48.144 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:48.144 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:05:48.145 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 28.3283ms
2025-11-15 04:05:48.778 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:05:48.778 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:48.779 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:05:48.803 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:05:48.803 +03:00 [ERR] No token
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:05:48.804 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 24.9329ms
2025-11-15 04:05:48.804 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:05:48.804 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: No token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:05:48.805 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 27.1358ms
2025-11-15 04:05:52.182 +03:00 [INF] Application is shutting down...
2025-11-15 04:05:55.571 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:05:55.619 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:05:55.621 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:05:55.621 +03:00 [INF] Hosting environment: Development
2025-11-15 04:05:55.621 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:06:08.365 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:06:08.386 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:06:08.410 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:06:08.426 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:08.932 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:06:09.005 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:09.031 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:09.037 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:09.047 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:09.048 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:09.106 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:09.119 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:09.123 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:09.129 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 701.6266ms
2025-11-15 04:06:09.130 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:06:09.133 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 768.587ms
2025-11-15 04:06:16.743 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:16.749 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:16.757 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:16.815 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:16.829 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:16.840 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:16.842 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:16.843 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:16.844 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:16.845 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:16.851 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:16.853 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:16.854 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:16.854 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 96.589ms
2025-11-15 04:06:16.854 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:16.854 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 111.2575ms
2025-11-15 04:06:17.981 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:17.985 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:17.985 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:18.023 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:18.025 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:18.031 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:18.032 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:18.032 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:18.033 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:18.034 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:18.036 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:18.037 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:18.037 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:18.037 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 51.8776ms
2025-11-15 04:06:18.037 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:18.038 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 56.798ms
2025-11-15 04:06:18.680 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:18.681 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:18.681 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:18.699 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:18.701 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:18.703 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:18.704 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:18.704 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:18.705 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:18.706 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:18.708 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:18.709 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:18.709 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:18.709 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 28.321ms
2025-11-15 04:06:18.709 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:18.710 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 29.5174ms
2025-11-15 04:06:19.197 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:19.198 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:19.198 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:19.221 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:19.222 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:19.223 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:19.225 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:19.226 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:19.228 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:19.229 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:19.231 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:19.233 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:19.233 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:19.233 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 34.9185ms
2025-11-15 04:06:19.233 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:19.233 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 36.0114ms
2025-11-15 04:06:19.632 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:19.632 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:19.632 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:19.645 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:19.645 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:19.646 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:19.647 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:19.647 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:19.648 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:19.648 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:19.649 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:19.650 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:19.650 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:19.650 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 18.3766ms
2025-11-15 04:06:19.650 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:19.651 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 18.9399ms
2025-11-15 04:06:20.071 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:20.071 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:20.071 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:20.085 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:20.086 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:20.087 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:20.088 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:20.088 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:20.089 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:20.089 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:20.091 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:20.091 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:20.091 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:20.091 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 20.5315ms
2025-11-15 04:06:20.091 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:20.092 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 21.077ms
2025-11-15 04:06:20.531 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:20.532 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:20.532 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:20.555 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:20.557 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:20.558 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:20.560 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:20.562 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:20.564 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:20.565 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:20.568 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:20.569 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:20.569 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:20.570 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 36.9451ms
2025-11-15 04:06:20.570 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:20.570 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 38.6654ms
2025-11-15 04:06:20.929 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:20.930 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:20.930 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:20.953 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:20.954 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:06:20.955 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:20.956 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:20.958 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:20.959 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:20.960 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:20.962 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:20.962 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:20.962 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:20.962 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 31.9955ms
2025-11-15 04:06:20.962 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:20.962 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 33.1621ms
2025-11-15 04:06:25.653 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:06:25.667 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:06:25.684 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:06:25.685 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 31.8ms
2025-11-15 04:06:26.547 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:06:26.550 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:06:26.550 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:06:26.551 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 3.8998ms
2025-11-15 04:06:27.138 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:06:27.140 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:06:27.141 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:06:27.141 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 3.62ms
2025-11-15 04:06:27.579 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:06:27.580 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:06:27.580 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:06:27.581 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 1.24ms
2025-11-15 04:06:33.904 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:06:33.942 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-15 04:06:33.943 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-11-15 04:06:33.943 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:06:33.944 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:06:33.944 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 40.2256ms
2025-11-15 04:06:37.768 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:06:37.798 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:06:37.826 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:37.853 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:06:37.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:37.856 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:06:37.860 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 33.95ms
2025-11-15 04:06:37.860 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:06:37.860 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 92.0355ms
2025-11-15 04:06:41.976 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:06:41.978 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:41.978 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:42.006 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:06:42.007 +03:00 [ERR] Invalid token
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:06:42.009 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 30.2861ms
2025-11-15 04:06:42.009 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:06:42.009 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 40
   at lambda_method316(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:06:42.012 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 35.3018ms
2025-11-15 04:06:46.620 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:06:46.621 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:06:46.622 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:46.650 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:06:46.707 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:46.709 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:46.710 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:46.711 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:46.711 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:46.713 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:46.714 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:46.715 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:46.715 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 93.3782ms
2025-11-15 04:06:46.715 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:06:46.715 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 95.3484ms
2025-11-15 04:06:52.780 +03:00 [INF] Application is shutting down...
2025-11-15 04:06:55.281 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:06:55.325 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:06:55.326 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:06:55.326 +03:00 [INF] Hosting environment: Development
2025-11-15 04:06:55.326 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:06:58.899 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:06:58.916 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:06:58.928 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:06:58.944 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:06:59.405 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:06:59.471 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:06:59.491 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:59.497 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:59.507 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:06:59.509 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:06:59.559 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:06:59.569 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:06:59.573 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:06:59.580 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 634.3189ms
2025-11-15 04:06:59.580 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:06:59.583 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 685.398ms
2025-11-15 04:07:08.021 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:08.038 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:07:08.054 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:07:08.054 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 33.9528ms
2025-11-15 04:07:09.031 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:09.035 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:07:09.039 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:07:09.039 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 8.5266ms
2025-11-15 04:07:09.558 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:09.559 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:07:09.560 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:07:09.560 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 2.5291ms
2025-11-15 04:07:10.032 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:10.033 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:07:10.033 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:07:10.034 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.9426ms
2025-11-15 04:07:10.432 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:10.433 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:07:10.433 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:07:10.433 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.3885ms
2025-11-15 04:07:26.404 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:26.442 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:26.446 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:07:26.504 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:07:26.514 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:07:26.521 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:07:26.526 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:26.528 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:26.529 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:26.530 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:26.533 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:07:26.535 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:07:26.535 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:07:26.535 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 89.1986ms
2025-11-15 04:07:26.535 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:26.535 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 131.4699ms
2025-11-15 04:07:27.855 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:27.856 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:27.857 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:07:27.891 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:07:27.893 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:07:27.898 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:07:27.901 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:27.902 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:27.904 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:27.904 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:27.906 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:07:27.908 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:07:27.908 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:07:27.908 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 51.1783ms
2025-11-15 04:07:27.908 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:27.908 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 53.3052ms
2025-11-15 04:07:28.531 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:28.532 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:28.532 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:07:28.548 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:07:28.549 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:07:28.550 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:07:28.551 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:28.551 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:28.552 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:28.553 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:28.555 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:07:28.555 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:07:28.555 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:07:28.555 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 23.6508ms
2025-11-15 04:07:28.556 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:28.556 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 24.443ms
2025-11-15 04:07:29.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:29.081 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:29.081 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:07:29.107 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:07:29.109 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:07:29.111 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:07:29.113 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:29.115 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:29.117 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:29.119 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:29.121 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:07:29.122 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:07:29.122 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:07:29.123 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 41.5982ms
2025-11-15 04:07:29.123 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:29.123 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 43.2256ms
2025-11-15 04:07:29.627 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:07:29.628 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:29.628 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:07:29.640 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:07:29.642 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:07:29.643 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = TRUE, Expired = TRUE
        WHERE UserId = '@p0'
          AND DeviceId = '@p1'
          AND Revoked = FALSE
          AND Expired = FALSE
2025-11-15 04:07:29.644 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:29.645 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:29.645 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:07:29.646 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:07:29.647 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:07:29.648 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:07:29.648 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:07:29.648 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 20.3329ms
2025-11-15 04:07:29.648 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:07:29.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 21.4112ms
2025-11-15 04:08:51.079 +03:00 [INF] Application is shutting down...
2025-11-15 04:08:54.869 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:08:54.919 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:08:54.920 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:08:54.920 +03:00 [INF] Hosting environment: Development
2025-11-15 04:08:54.920 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:08:58.032 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:08:58.064 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:08:58.094 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:08:58.120 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:08:58.685 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:08:58.774 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:08:58.796 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:08:58.800 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:08:58.811 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:08:58.812 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:08:58.862 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:08:58.872 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:08:58.876 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:08:58.883 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 756.1886ms
2025-11-15 04:08:58.883 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:08:58.886 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 856.5439ms
2025-11-15 04:09:13.032 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:09:13.073 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:09:13.083 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:09:13.134 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:09:13.139 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:09:13.140 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:09:13.145 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 61.0407ms
2025-11-15 04:09:13.145 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:09:13.146 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 114.678ms
2025-11-15 04:09:16.638 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:09:16.644 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:09:16.658 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:09:16.658 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 19.4867ms
2025-11-15 04:09:32.039 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:09:32.044 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:09:32.044 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:09:32.080 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:09:32.081 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 36.9803ms
2025-11-15 04:09:32.081 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:09:32.082 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:09:32.134 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 94.3807ms
2025-11-15 04:09:48.808 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:09:48.809 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:09:48.809 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:09:48.837 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:09:48.838 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 29.0972ms
2025-11-15 04:09:48.839 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:09:48.839 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 49
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:09:48.841 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 33.2508ms
2025-11-15 04:09:51.854 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 60
2025-11-15 04:09:51.855 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:09:51.855 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:09:51.883 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:09:51.940 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:09:51.941 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:09:51.942 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:09:51.943 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:09:51.944 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:09:51.946 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:09:51.949 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:09:51.950 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:09:51.950 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 94.8704ms
2025-11-15 04:09:51.950 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:09:51.950 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 96.1569ms
2025-11-15 04:10:02.307 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:10:02.308 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:10:02.309 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:10:02.334 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:10:02.339 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:10:02.340 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:10:02.340 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 31.2137ms
2025-11-15 04:10:02.340 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:10:02.340 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 32.987ms
2025-11-15 04:10:15.424 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:10:15.426 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:10:15.427 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:10:15.469 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:10:15.525 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:10:15.527 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:10:15.528 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:10:15.529 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:10:15.529 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:10:15.536 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:10:15.537 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:10:15.538 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:10:15.538 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 110.6777ms
2025-11-15 04:10:15.538 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:10:15.538 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 114.6644ms
2025-11-15 04:11:12.592 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:11:12.595 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:11:12.596 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:12.637 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:11:12.696 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:12.699 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:12.700 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:12.702 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:12.703 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:12.706 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:12.707 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:12.707 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:12.707 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 111.3742ms
2025-11-15 04:11:12.707 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:11:12.708 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 115.2715ms
2025-11-15 04:11:18.088 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:18.089 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:11:18.090 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:11:18.090 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 2.0648ms
2025-11-15 04:11:21.943 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:21.948 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:21.954 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:21.983 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:22.020 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:22.031 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:22.033 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:22.034 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:22.035 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:22.036 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:22.039 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:22.040 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:22.041 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:22.041 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 87.0592ms
2025-11-15 04:11:22.041 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:22.041 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 97.823ms
2025-11-15 04:11:23.317 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:23.318 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:23.318 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:23.343 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:23.344 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:23.346 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:23.347 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:23.347 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:23.348 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:23.349 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:23.351 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:23.352 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:23.352 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:23.352 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 34.2948ms
2025-11-15 04:11:23.352 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:23.353 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 36.0818ms
2025-11-15 04:11:29.638 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:29.639 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:29.639 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:29.664 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:29.665 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:29.668 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:29.669 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:29.670 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:29.671 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:29.671 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:29.673 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:29.674 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:29.674 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:29.674 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 34.8956ms
2025-11-15 04:11:29.674 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:29.674 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 36.004ms
2025-11-15 04:11:30.278 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:30.279 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:30.279 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:30.303 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:30.305 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:30.309 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:30.310 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:30.311 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:30.311 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:30.312 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:30.314 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:30.314 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:30.314 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:30.314 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 35.0032ms
2025-11-15 04:11:30.315 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:30.315 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 36.4551ms
2025-11-15 04:11:30.717 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:30.718 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:30.718 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:30.743 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:30.744 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:30.746 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:30.747 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:30.748 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:30.750 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:30.751 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:30.754 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:30.755 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:30.755 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:30.756 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 37.4302ms
2025-11-15 04:11:30.756 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:30.756 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 38.9416ms
2025-11-15 04:11:31.202 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:31.203 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:31.203 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:31.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:31.230 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:31.231 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:31.232 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:31.233 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:31.234 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:31.235 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:31.237 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:31.237 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:31.237 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:31.238 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 33.7523ms
2025-11-15 04:11:31.238 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:31.238 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 36.2847ms
2025-11-15 04:11:40.542 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:11:40.543 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:40.544 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:11:40.570 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:11:40.572 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:11:40.574 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:11:40.575 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:40.576 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:40.577 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:11:40.578 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:11:40.581 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:11:40.582 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:11:40.583 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:11:40.583 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 38.7656ms
2025-11-15 04:11:40.583 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:11:40.583 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 40.9553ms
2025-11-15 04:21:41.981 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:21:41.988 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:21:41.990 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:21:42.164 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:21:42.238 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:21:42.243 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:21:42.244 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:21:42.246 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:21:42.246 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:21:42.256 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:21:42.258 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:21:42.258 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:21:42.258 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 267.8013ms
2025-11-15 04:21:42.258 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:21:42.258 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 276.9525ms
2025-11-15 04:21:45.763 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:45.771 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:21:45.772 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:21:45.803 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:21:45.807 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:21:45.809 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:21:45.810 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:21:45.811 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:21:45.812 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:21:45.813 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:21:45.818 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:21:45.819 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:21:45.820 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:21:45.820 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 47.6456ms
2025-11-15 04:21:45.820 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:21:45.820 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 56.9762ms
2025-11-15 04:21:50.061 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:50.063 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:21:50.063 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:21:50.063 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 2.4444ms
2025-11-15 04:21:51.017 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:51.018 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:21:51.018 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:21:51.018 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 0.9226ms
2025-11-15 04:21:51.712 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:51.713 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:21:51.713 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:21:51.713 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.0627ms
2025-11-15 04:21:52.265 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:52.266 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:21:52.266 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:21:52.266 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 0.7882ms
2025-11-15 04:21:56.600 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:56.600 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:21:56.602 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:21:56.602 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.9707ms
2025-11-15 04:21:57.234 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:21:57.234 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:21:57.234 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:21:57.235 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 1.0161ms
2025-11-15 04:22:04.081 +03:00 [INF] Application is shutting down...
2025-11-15 04:22:08.964 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:22:09.018 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:22:09.019 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:22:09.019 +03:00 [INF] Hosting environment: Development
2025-11-15 04:22:09.019 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:22:11.771 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:22:11.786 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:22:11.799 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:11.809 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:12.244 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:22:12.283 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:22:12.307 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:22:12.329 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:22:12.335 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:22:12.344 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:22:12.348 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:22:12.390 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:22:12.399 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:22:12.404 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:22:12.424 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 614.0168ms
2025-11-15 04:22:12.425 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:12.427 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 656.9514ms
2025-11-15 04:22:13.263 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:22:13.269 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:13.270 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:13.299 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:22:13.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:22:13.304 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:22:13.306 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:22:13.307 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:22:13.308 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:22:13.309 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:22:13.316 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:22:13.317 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:22:13.317 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:22:13.318 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 47.8209ms
2025-11-15 04:22:13.318 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:13.318 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 54.7697ms
2025-11-15 04:22:13.968 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:22:13.973 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:13.973 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:14.029 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:22:14.031 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:22:14.038 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:22:14.039 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:22:14.041 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:22:14.042 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:22:14.043 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:22:14.045 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:22:14.045 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:22:14.045 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:22:14.046 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 71.8027ms
2025-11-15 04:22:14.046 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:14.046 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 77.7968ms
2025-11-15 04:22:19.782 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:22:19.793 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:22:19.803 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:19.857 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:22:19.860 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:22:19.862 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:22:19.870 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 67.0105ms
2025-11-15 04:22:19.870 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:22:19.871 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 89.0343ms
2025-11-15 04:22:20.865 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:22:20.866 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:22:20.866 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:20.897 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:22:20.903 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 36.5894ms
2025-11-15 04:22:20.904 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:22:20.904 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 47
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:22:20.922 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 56.9526ms
2025-11-15 04:22:22.063 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:22:22.064 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:22:22.064 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:22.093 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:22:22.093 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 29.393ms
2025-11-15 04:22:22.094 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:22:22.094 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 101
   at MappyApplication.Controllers.AuthController.Logout() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 47
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:22:22.095 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 400 null application/json; charset=utf-8 32.2933ms
2025-11-15 04:22:25.511 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:22:25.511 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:25.511 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:22:25.537 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:22:25.537 +03:00 [ERR] Invalid token
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:22:25.538 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 26.5081ms
2025-11-15 04:22:25.538 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:22:25.538 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 39
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:22:25.539 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 28.2155ms
2025-11-15 04:24:23.145 +03:00 [INF] Application is shutting down...
2025-11-15 04:24:27.742 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:24:27.795 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:24:27.796 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:24:27.796 +03:00 [INF] Hosting environment: Development
2025-11-15 04:24:27.796 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:24:32.702 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 04:24:32.761 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 60.3642ms
2025-11-15 04:24:32.984 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 04:24:33.028 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 44.0291ms
2025-11-15 04:24:42.187 +03:00 [INF] Application is shutting down...
2025-11-15 04:24:46.396 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:24:46.448 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:24:46.449 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:24:46.449 +03:00 [INF] Hosting environment: Development
2025-11-15 04:24:46.449 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:24:47.015 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 04:24:47.065 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 51.3217ms
2025-11-15 04:24:47.175 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 04:24:47.210 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 34.8667ms
2025-11-15 04:24:51.912 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:24:51.920 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:24:51.945 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:24:51.960 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:24:51.963 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:24:51.966 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 3.8809ms
2025-11-15 04:24:51.966 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:24:51.966 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 54.2735ms
2025-11-15 04:25:15.201 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:15.234 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 32.628ms
2025-11-15 04:25:15.235 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:25:32.083 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/HellO
 - null null
2025-11-15 04:25:32.089 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/HellO
 - 404 null application/json; charset=utf-8 5.8935ms
2025-11-15 04:25:32.090 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/HellO%0A, Response status code: 404
2025-11-15 04:25:41.548 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:41.550 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 2.0904ms
2025-11-15 04:25:41.550 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:25:42.641 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:42.649 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 8.3272ms
2025-11-15 04:25:42.649 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:25:57.855 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:57.861 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 6.604ms
2025-11-15 04:25:57.862 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:25:58.594 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:58.595 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 1.1121ms
2025-11-15 04:25:58.595 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:25:59.145 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:59.146 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 1.2676ms
2025-11-15 04:25:59.147 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:25:59.594 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - null null
2025-11-15 04:25:59.595 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello
 - 404 null application/json; charset=utf-8 0.9657ms
2025-11-15 04:25:59.595 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/api/v1/Hello%0A, Response status code: 404
2025-11-15 04:26:09.553 +03:00 [INF] Application is shutting down...
2025-11-15 04:26:11.970 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:26:12.016 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:26:12.017 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:26:12.017 +03:00 [INF] Hosting environment: Development
2025-11-15 04:26:12.017 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:26:17.518 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 04:26:17.570 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 53.1562ms
2025-11-15 04:26:17.673 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 04:26:17.714 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.9273ms
2025-11-15 04:26:23.418 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:26:23.431 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:26:23.433 +03:00 [INF] CORS policy execution failed.
2025-11-15 04:26:23.433 +03:00 [INF] Request origin http://localhost:8080 does not have permission to access the resource.
2025-11-15 04:26:23.458 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:26:23.477 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:26:23.967 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE FALSE
LIMIT 2
2025-11-15 04:26:23.971 +03:00 [ERR] Invalid token
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByRefreshToken(String refreshToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 36
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 82
2025-11-15 04:26:23.976 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 496.969ms
2025-11-15 04:26:23.976 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:26:23.976 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.AuthManager.Refresh() in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 93
   at MappyApplication.Controllers.AuthController.RefreshToken() in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 39
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 110
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:26:23.992 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 400 null application/json; charset=utf-8 574.7794ms
2025-11-15 04:26:33.242 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:26:33.245 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:33.251 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:26:33.260 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:26:33.262 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 10.3472ms
2025-11-15 04:26:33.262 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:33.263 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 20.3296ms
2025-11-15 04:26:34.801 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:26:34.807 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:34.807 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:26:34.808 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:26:34.808 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.9806ms
2025-11-15 04:26:34.809 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:34.809 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 7.7207ms
2025-11-15 04:26:52.212 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:26:52.217 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:52.217 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:26:52.233 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:26:52.233 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 15.8461ms
2025-11-15 04:26:52.234 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:52.234 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 21.4219ms
2025-11-15 04:26:52.410 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/favicon.ico - null null
2025-11-15 04:26:52.412 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/favicon.ico - 404 null application/json; charset=utf-8 2.066ms
2025-11-15 04:26:52.413 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/favicon.ico, Response status code: 404
2025-11-15 04:26:57.741 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:26:57.745 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:57.747 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:26:57.749 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:26:57.750 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 2.2429ms
2025-11-15 04:26:57.750 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:26:57.750 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 9.0822ms
2025-11-15 04:27:36.246 +03:00 [INF] Application is shutting down...
2025-11-15 04:27:40.503 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:27:40.565 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:27:40.566 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:27:40.566 +03:00 [INF] Hosting environment: Development
2025-11-15 04:27:40.566 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:27:42.330 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:42.348 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:27:42.369 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:42.400 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:42.401 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 71.7259ms
2025-11-15 04:27:43.545 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:43.552 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:43.553 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:43.554 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 9.514ms
2025-11-15 04:27:44.192 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:44.196 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:44.196 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:44.197 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 4.2528ms
2025-11-15 04:27:44.706 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:44.707 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:44.707 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:44.707 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 1.0963ms
2025-11-15 04:27:46.077 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:46.079 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:46.079 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:46.080 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 2.2836ms
2025-11-15 04:27:46.591 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:46.592 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:46.592 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:46.592 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 1.8294ms
2025-11-15 04:27:47.357 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:27:47.358 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:27:47.358 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:27:47.358 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 2.0029ms
2025-11-15 04:27:54.614 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:27:54.619 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:27:54.638 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:27:55.230 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:27:55.303 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:27:55.324 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:27:55.331 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:27:55.340 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:27:55.341 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:27:55.402 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:27:55.416 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:27:55.420 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:27:55.423 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 783.1212ms
2025-11-15 04:27:55.423 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:27:55.425 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 810.8124ms
2025-11-15 04:28:20.283 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:20.321 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:20.324 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:20.325 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:20.326 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 1.0187ms
2025-11-15 04:28:20.326 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:20.326 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 43.0668ms
2025-11-15 04:28:21.388 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:21.390 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:21.391 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:21.391 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:21.391 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.7408ms
2025-11-15 04:28:21.392 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:21.392 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 3.4694ms
2025-11-15 04:28:22.103 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:22.104 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:22.104 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:22.104 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:22.105 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.5107ms
2025-11-15 04:28:22.105 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:22.105 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.8845ms
2025-11-15 04:28:25.980 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 04:28:25.983 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:28:25.987 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:28:26.058 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:28:26.066 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:28:26.067 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 04:28:26.072 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 84.073ms
2025-11-15 04:28:26.072 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 04:28:26.072 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 91.9813ms
2025-11-15 04:28:30.345 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:30.346 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:30.346 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:30.346 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:30.347 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.3194ms
2025-11-15 04:28:30.347 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:30.347 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.3327ms
2025-11-15 04:28:31.942 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:31.943 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:31.943 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:31.944 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:31.944 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.4393ms
2025-11-15 04:28:31.944 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:31.944 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.0923ms
2025-11-15 04:28:32.720 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:32.722 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:32.722 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:32.723 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:32.723 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.3122ms
2025-11-15 04:28:32.723 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:32.723 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.7567ms
2025-11-15 04:28:33.388 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:28:33.389 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:33.390 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:28:33.390 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:28:33.390 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.3763ms
2025-11-15 04:28:33.391 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:28:33.391 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.6918ms
2025-11-15 04:29:31.051 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:29:31.080 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-15 04:29:31.081 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-11-15 04:29:31.082 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:29:31.084 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:29:31.084 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 32.9163ms
2025-11-15 04:29:31.843 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:29:31.844 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-15 04:29:31.846 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2025-11-15 04:29:31.846 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 04:29:31.847 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 04:29:31.847 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 4.1389ms
2025-11-15 04:29:36.248 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:29:36.249 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:29:36.249 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:29:36.250 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:29:36.251 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.7619ms
2025-11-15 04:29:36.251 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:29:36.251 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.9815ms
2025-11-15 04:29:37.053 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:29:37.054 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:29:37.054 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:29:37.055 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:29:37.055 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.3774ms
2025-11-15 04:29:37.055 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:29:37.055 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.6427ms
2025-11-15 04:29:39.879 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:29:39.880 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:29:39.880 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:29:39.880 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:29:39.881 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.4457ms
2025-11-15 04:29:39.881 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:29:39.881 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 2.2306ms
2025-11-15 04:44:01.898 +03:00 [INF] Application is shutting down...
2025-11-15 04:44:06.759 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:44:06.843 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:44:06.844 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:44:06.845 +03:00 [INF] Hosting environment: Development
2025-11-15 04:44:06.845 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:44:08.521 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:44:08.540 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:44:08.729 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 87
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:44:08.733 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 87
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:44:08.737 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 216.6309ms
2025-11-15 04:44:09.995 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:44:10.028 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 87
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:44:10.028 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 87
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:44:10.029 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 35.2585ms
2025-11-15 04:47:55.739 +03:00 [INF] Application is shutting down...
2025-11-15 04:48:00.056 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:48:00.109 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:48:00.110 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:48:00.110 +03:00 [INF] Hosting environment: Development
2025-11-15 04:48:00.110 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:48:03.163 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:03.181 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:48:03.361 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:03.364 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:03.368 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 206.2972ms
2025-11-15 04:48:04.393 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:04.420 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:04.421 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:04.422 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 29.9484ms
2025-11-15 04:48:05.172 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:05.197 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:05.198 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:05.199 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 27.5188ms
2025-11-15 04:48:05.974 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:05.999 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:05.999 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:06.000 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 26.7891ms
2025-11-15 04:48:07.035 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:07.056 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:07.056 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:07.057 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 22.406ms
2025-11-15 04:48:07.990 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:08.012 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:08.013 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 90
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:08.014 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 24.1968ms
2025-11-15 04:48:43.239 +03:00 [INF] Application is shutting down...
2025-11-15 04:48:46.685 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:48:46.739 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:48:46.740 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:48:46.740 +03:00 [INF] Hosting environment: Development
2025-11-15 04:48:46.740 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:48:49.653 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:49.669 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:48:49.812 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:49.815 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:49.816 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:48:49.817 +03:00 [ERR] Connection id "0HNH3T4FOAT2U", Request id "0HNH3T4FOAT2U:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:48:49.819 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 166.6149ms
2025-11-15 04:48:51.125 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:51.156 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:51.156 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:51.156 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:48:51.156 +03:00 [ERR] Connection id "0HNH3T4FOAT30", Request id "0HNH3T4FOAT30:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:48:51.157 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 32.4989ms
2025-11-15 04:48:51.770 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:51.799 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:51.800 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:51.800 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:48:51.800 +03:00 [ERR] Connection id "0HNH3T4FOAT32", Request id "0HNH3T4FOAT32:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:48:51.802 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 32.133ms
2025-11-15 04:48:52.324 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:52.358 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:52.359 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:52.359 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:48:52.360 +03:00 [ERR] Connection id "0HNH3T4FOAT34", Request id "0HNH3T4FOAT34:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:48:52.360 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 36.1333ms
2025-11-15 04:48:53.474 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:48:53.505 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:48:53.686 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:48:53.686 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:48:53.686 +03:00 [ERR] Connection id "0HNH3T4FOAT36", Request id "0HNH3T4FOAT36:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:48:53.687 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 213.7592ms
2025-11-15 04:48:56.437 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:48:56.447 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:48:56.472 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:48:56.885 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:48:56.956 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:48:56.977 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:48:56.982 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:48:56.988 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:48:56.989 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:48:57.047 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:48:57.061 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:48:57.064 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:48:57.067 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 593.8301ms
2025-11-15 04:48:57.067 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:48:57.070 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 632.2905ms
2025-11-15 04:49:11.346 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:49:11.393 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:49:11.394 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:49:11.394 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:49:11.394 +03:00 [ERR] Connection id "0HNH3T4FOAT38", Request id "0HNH3T4FOAT38:00000002": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:49:11.395 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 48.6832ms
2025-11-15 04:49:12.257 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:49:12.281 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:49:12.282 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:49:12.283 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:49:12.284 +03:00 [ERR] Connection id "0HNH3T4FOAT3A", Request id "0HNH3T4FOAT3A:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:49:12.285 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 27.7933ms
2025-11-15 04:49:17.377 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 04:49:17.379 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:49:17.388 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:49:17.462 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 04:49:17.474 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 04:49:17.491 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:49:17.493 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:49:17.494 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:49:17.495 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:49:17.496 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:49:17.499 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:49:17.501 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:49:17.501 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:49:17.501 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 112.3556ms
2025-11-15 04:49:17.501 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 04:49:17.501 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 124.6147ms
2025-11-15 04:49:31.045 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:49:31.074 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:49:31.075 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:49:31.075 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:49:31.075 +03:00 [ERR] Connection id "0HNH3T4FOAT3C", Request id "0HNH3T4FOAT3C:00000002": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:49:31.076 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 30.7698ms
2025-11-15 04:49:32.293 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:49:32.320 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:49:32.321 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:49:32.321 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:49:32.322 +03:00 [ERR] Connection id "0HNH3T4FOAT3E", Request id "0HNH3T4FOAT3E:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:49:32.323 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 30.5507ms
2025-11-15 04:49:55.467 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:49:55.495 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:49:55.496 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:49:55.497 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:49:55.498 +03:00 [ERR] Connection id "0HNH3T4FOAT3G", Request id "0HNH3T4FOAT3G:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:49:55.498 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 31.3048ms
2025-11-15 04:49:59.031 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:49:59.032 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:49:59.032 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:49:59.081 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:49:59.136 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:49:59.137 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:49:59.138 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:49:59.139 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:49:59.140 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:49:59.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:49:59.144 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:49:59.144 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:49:59.144 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 111.2872ms
2025-11-15 04:49:59.144 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:49:59.144 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 113.2072ms
2025-11-15 04:50:14.505 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:50:14.529 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:50:14.529 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:50:14.530 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:50:14.530 +03:00 [ERR] Connection id "0HNH3T4FOAT3I", Request id "0HNH3T4FOAT3I:00000002": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:50:14.532 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 26.5528ms
2025-11-15 04:50:15.436 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:50:15.459 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:50:15.459 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:50:15.460 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:50:15.460 +03:00 [ERR] Connection id "0HNH3T4FOAT3K", Request id "0HNH3T4FOAT3K:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:50:15.461 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 25.2032ms
2025-11-15 04:50:16.003 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:50:16.022 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:50:16.022 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:50:16.022 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:50:16.023 +03:00 [ERR] Connection id "0HNH3T4FOAT3M", Request id "0HNH3T4FOAT3M:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:50:16.023 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 20.323ms
2025-11-15 04:50:16.390 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:50:16.414 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:50:16.415 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:50:16.415 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:50:16.415 +03:00 [ERR] Connection id "0HNH3T4FOAT3O", Request id "0HNH3T4FOAT3O:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:50:16.416 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 25.8784ms
2025-11-15 04:50:59.903 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:51:00.000 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:51:00.003 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:51:00.007 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:51:00.007 +03:00 [ERR] Connection id "0HNH3T4FOAT3Q", Request id "0HNH3T4FOAT3Q:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:51:00.009 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 106.142ms
2025-11-15 04:51:17.123 +03:00 [INF] Application is shutting down...
2025-11-15 04:51:21.687 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:51:21.740 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:51:21.741 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:51:21.741 +03:00 [INF] Hosting environment: Development
2025-11-15 04:51:21.741 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:51:24.799 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:51:24.815 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:51:24.974 +03:00 [ERR] Exception occurred while processing message.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:51:24.980 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:51:24.981 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:51:24.982 +03:00 [ERR] Connection id "0HNH3T5TVT0B2", Request id "0HNH3T5TVT0B2:00000001": An unhandled exception was thrown by the application.
System.NullReferenceException: Object reference not set to an instance of an object.
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:51:24.984 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 185.2556ms
2025-11-15 04:54:08.197 +03:00 [INF] Application is shutting down...
2025-11-15 04:54:12.375 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 04:54:12.425 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 04:54:12.426 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 04:54:12.427 +03:00 [INF] Hosting environment: Development
2025-11-15 04:54:12.427 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 04:54:14.094 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:14.109 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 04:54:14.628 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:14.648 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:14.656 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:54:14.659 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:54:14.661 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 4.0344ms
2025-11-15 04:54:14.662 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:14.666 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 572.6809ms
2025-11-15 04:54:18.836 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:54:18.846 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:54:18.860 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:54:18.983 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:54:19.057 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:54:19.080 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:54:19.086 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:54:19.094 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:54:19.096 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:54:19.171 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:54:19.182 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:54:19.186 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:54:19.192 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 331.5436ms
2025-11-15 04:54:19.192 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:54:19.193 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 357.2005ms
2025-11-15 04:54:27.454 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:27.536 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:27.567 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:27.569 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:54:27.573 +03:00 [WRN] No output formatter was found for content types '["application/json; charset=utf-8","application/json; charset=utf-8"]' to write the response.
2025-11-15 04:54:27.578 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 8.0691ms
2025-11-15 04:54:27.579 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:27.580 +03:00 [ERR] An error occured
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 126
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:54:27.597 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_ContentType(StringValues value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_ContentType(String value)
   at MappyApplication.Exceptions.AppErrorResponse.HandelException(HttpContext ctx, Int32 statusCode, String message) in /Users/salah/Desktop/MappyApplication/MappyApplication/Exceptions/AppErrorResponse.cs:line 11
   at MappyApplication.MiddleWare.ExceptionMiddleWare.HandelAsync(HttpContext ctx, Exception ex) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 40
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 26
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:27.599 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:54:27.600 +03:00 [ERR] Connection id "0HNH3T7GEBGGC", Request id "0HNH3T7GEBGGC:00000003": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_ContentType(StringValues value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_ContentType(String value)
   at MappyApplication.Exceptions.AppErrorResponse.HandelException(HttpContext ctx, Int32 statusCode, String message) in /Users/salah/Desktop/MappyApplication/MappyApplication/Exceptions/AppErrorResponse.cs:line 11
   at MappyApplication.MiddleWare.ExceptionMiddleWare.HandelAsync(HttpContext ctx, Exception ex) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 40
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 26
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:54:27.600 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 147.4597ms
2025-11-15 04:54:32.258 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:32.286 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:32.287 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:32.287 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:54:32.288 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 04:54:32.288 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.3771ms
2025-11-15 04:54:32.288 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:32.288 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 30.1539ms
2025-11-15 04:54:35.712 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 04:54:35.716 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:54:35.716 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 04:54:35.744 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 04:54:35.801 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 04:54:35.802 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:54:35.803 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:54:35.804 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 04:54:35.804 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 04:54:35.808 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 04:54:35.808 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 04:54:35.809 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 04:54:35.809 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 92.7928ms
2025-11-15 04:54:35.809 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 04:54:35.809 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 96.9211ms
2025-11-15 04:54:43.540 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:43.575 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:43.579 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:43.580 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 04:54:43.581 +03:00 [WRN] No output formatter was found for content types '["application/json; charset=utf-8","application/json; charset=utf-8"]' to write the response.
2025-11-15 04:54:43.582 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 1.4791ms
2025-11-15 04:54:43.582 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 04:54:43.582 +03:00 [ERR] An error occured
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 126
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 04:54:43.584 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_ContentType(StringValues value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_ContentType(String value)
   at MappyApplication.Exceptions.AppErrorResponse.HandelException(HttpContext ctx, Int32 statusCode, String message) in /Users/salah/Desktop/MappyApplication/MappyApplication/Exceptions/AppErrorResponse.cs:line 11
   at MappyApplication.MiddleWare.ExceptionMiddleWare.HandelAsync(HttpContext ctx, Exception ex) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 40
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 26
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:43.584 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-11-15 04:54:43.585 +03:00 [ERR] Connection id "0HNH3T7GEBGGE", Request id "0HNH3T7GEBGGE:00000003": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_ContentType(StringValues value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_ContentType(String value)
   at MappyApplication.Exceptions.AppErrorResponse.HandelException(HttpContext ctx, Int32 statusCode, String message) in /Users/salah/Desktop/MappyApplication/MappyApplication/Exceptions/AppErrorResponse.cs:line 11
   at MappyApplication.MiddleWare.ExceptionMiddleWare.HandelAsync(HttpContext ctx, Exception ex) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 40
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 26
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-11-15 04:54:43.585 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 45.1673ms
2025-11-15 04:54:46.413 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:46.428 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:46.429 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:54:46.430 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:46.431 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 18.2217ms
2025-11-15 04:54:47.554 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:47.578 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:47.578 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:54:47.579 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:47.580 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 25.7607ms
2025-11-15 04:54:48.213 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:48.238 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:48.239 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:54:48.239 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:48.240 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 26.8105ms
2025-11-15 04:54:48.896 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:48.919 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:48.920 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:54:48.920 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:48.921 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 24.9357ms
2025-11-15 04:54:55.917 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 04:54:55.954 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 04:54:55.954 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 04:54:55.955 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<<Main>$>b__0_11>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 93
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 04:54:55.956 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 39.5206ms
2025-11-15 05:01:35.534 +03:00 [INF] Application is shutting down...
2025-11-15 05:01:39.711 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 05:01:39.834 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 05:01:39.835 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 05:01:39.835 +03:00 [INF] Hosting environment: Development
2025-11-15 05:01:39.835 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 05:01:40.172 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:40.186 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 05:01:40.710 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:40.715 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:40.717 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:40.724 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 552.4161ms
2025-11-15 05:01:41.719 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:41.755 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:41.755 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:41.756 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:41.757 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 38.2307ms
2025-11-15 05:01:42.822 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:42.866 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:42.867 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:42.867 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:42.867 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 45.2799ms
2025-11-15 05:01:43.626 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:43.653 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:43.654 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:43.655 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:43.656 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 30.3042ms
2025-11-15 05:01:44.318 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:44.344 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:44.345 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:44.345 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:44.346 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 28.4955ms
2025-11-15 05:01:45.093 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:45.118 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:45.119 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:45.119 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:45.120 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 27.5518ms
2025-11-15 05:01:45.849 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:45.882 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:45.882 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:45.883 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:45.884 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 34.7632ms
2025-11-15 05:01:51.622 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 05:01:51.632 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:01:51.654 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:01:51.766 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 05:01:51.846 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:01:51.869 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:01:51.875 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:01:51.881 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:01:51.882 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:01:51.933 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:01:51.943 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:01:51.948 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:01:51.953 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 297.7137ms
2025-11-15 05:01:51.954 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:01:51.954 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 332.4296ms
2025-11-15 05:01:59.805 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:01:59.829 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:01:59.829 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:01:59.830 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 119
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:01:59.831 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 500 null text/plain; charset=utf-8 26.436ms
2025-11-15 05:02:03.174 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:03.200 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:02:03.210 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:02:03.214 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 05:02:03.215 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 05:02:03.216 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 2.0037ms
2025-11-15 05:02:03.216 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:02:03.216 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 42.8204ms
2025-11-15 05:02:08.195 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 05:02:08.200 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:02:08.200 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:02:08.224 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 05:02:08.278 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:02:08.279 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:02:08.280 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:02:08.281 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:02:08.281 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:02:08.285 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:02:08.286 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:02:08.286 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:02:08.286 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 85.6552ms
2025-11-15 05:02:08.286 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:02:08.286 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 90.9462ms
2025-11-15 05:02:13.070 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:13.093 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:02:13.095 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:02:13.097 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:02:13.107 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:02:13.107 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 36.7347ms
2025-11-15 05:02:15.269 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:15.297 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:02:15.297 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:02:15.298 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:02:15.298 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:02:15.298 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 29.0445ms
2025-11-15 05:02:16.141 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:16.165 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:02:16.165 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:02:16.165 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:02:16.166 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:02:16.166 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 24.5722ms
2025-11-15 05:02:16.874 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:16.900 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:02:16.901 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:02:16.901 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:02:16.901 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:02:16.901 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 26.8697ms
2025-11-15 05:02:29.970 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:02:29.971 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:02:29.978 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:02:30.016 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:02:30.027 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:02:30.041 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:02:30.042 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:02:30.043 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:02:30.045 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:02:30.045 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:02:30.047 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:02:30.048 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:02:30.048 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:02:30.048 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 70.2502ms
2025-11-15 05:02:30.048 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:02:30.048 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 78.7274ms
2025-11-15 05:02:40.471 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:40.503 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:02:40.504 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:02:40.505 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 05:02:40.505 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 05:02:40.505 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.4766ms
2025-11-15 05:02:40.506 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:02:40.506 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 35.3467ms
2025-11-15 05:02:44.770 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:02:44.771 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:02:44.771 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:02:44.798 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:02:44.801 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:02:44.804 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:02:44.806 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:02:44.807 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:02:44.808 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:02:44.808 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:02:44.812 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:02:44.818 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:02:44.819 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:02:44.819 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 48.0825ms
2025-11-15 05:02:44.819 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:02:44.819 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 49.693ms
2025-11-15 05:02:56.950 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:02:56.957 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenException: IDX10612: Decryption failed. Header.Enc is null or empty, it must be specified.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.DecryptToken(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWEAsync(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-15 05:02:56.958 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10612: Decryption failed. Header.Enc is null or empty, it must be specified.
2025-11-15 05:02:56.959 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:02:56.959 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:02:56.959 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 8.9989ms
2025-11-15 05:03:03.416 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:03:03.417 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:03:03.417 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:03:03.440 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:03:03.442 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:03:03.445 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:03:03.446 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:03:03.447 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:03:03.448 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:03:03.449 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:03:03.450 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:03:03.451 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:03:03.451 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:03:03.452 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 34.3822ms
2025-11-15 05:03:03.452 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:03:03.452 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 35.6679ms
2025-11-15 05:03:28.649 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:03:28.678 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:03:28.680 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:03:28.681 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 05:03:28.682 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 05:03:28.683 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 1.4401ms
2025-11-15 05:03:28.683 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:03:28.683 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 34.6093ms
2025-11-15 05:03:29.421 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:03:29.446 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:03:29.446 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:03:29.447 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 05:03:29.447 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 05:03:29.447 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.2147ms
2025-11-15 05:03:29.447 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:03:29.447 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 26.4912ms
2025-11-15 05:03:30.124 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:03:30.148 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:03:30.149 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:03:30.149 +03:00 [INF] Route matched with {action = "Hello", controller = "Hello"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] Hello() on controller MappyApplication.Controllers.HelloController (MappyApplication).
2025-11-15 05:03:30.149 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-11-15 05:03:30.149 +03:00 [INF] Executed action MappyApplication.Controllers.HelloController.Hello (MappyApplication) in 0.3057ms
2025-11-15 05:03:30.150 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.HelloController.Hello (MappyApplication)'
2025-11-15 05:03:30.150 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 200 null text/plain; charset=utf-8 25.705ms
2025-11-15 05:03:32.815 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:03:32.815 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 05:03:32.822 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:03:32.852 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:03:32.855 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:03:32.856 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 05:03:32.866 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 43.9726ms
2025-11-15 05:03:32.866 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 05:03:32.866 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 51.751ms
2025-11-15 05:03:36.202 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Hello - null null
2025-11-15 05:03:36.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:03:36.229 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:03:36.230 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:03:36.230 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:03:36.230 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Hello - 401 null application/json; charset=utf-8 28.5837ms
2025-11-15 05:04:54.074 +03:00 [INF] Application is shutting down...
2025-11-15 05:04:58.216 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 05:04:58.267 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 05:04:58.268 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 05:04:58.268 +03:00 [INF] Hosting environment: Development
2025-11-15 05:04:58.268 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 05:05:00.867 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 05:05:00.880 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 05:05:00.894 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:05:00.904 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:05:01.455 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 05:05:01.527 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:05:01.549 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:05:01.555 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:05:01.565 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:05:01.566 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:05:01.624 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:05:01.638 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:05:01.642 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:05:01.649 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 743.3181ms
2025-11-15 05:05:01.650 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:05:01.652 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 786.1509ms
2025-11-15 05:05:05.482 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:05.494 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:05:05.507 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:05:05.507 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 24.5726ms
2025-11-15 05:05:20.081 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:20.191 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:20.193 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:05:20.200 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:05:20.203 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 500 null text/plain; charset=utf-8 121.8044ms
2025-11-15 05:05:21.573 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:21.625 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:21.625 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:05:21.626 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:05:21.626 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 500 null text/plain; charset=utf-8 53.6188ms
2025-11-15 05:05:22.281 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:22.313 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:22.313 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:05:22.314 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:05:22.315 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 500 null text/plain; charset=utf-8 34.0435ms
2025-11-15 05:05:22.813 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:22.840 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:22.840 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:05:22.841 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:05:22.842 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 500 null text/plain; charset=utf-8 28.7108ms
2025-11-15 05:05:23.434 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:23.462 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:23.463 +03:00 [ERR] Exception occurred while processing message.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2025-11-15 05:05:23.463 +03:00 [ERR] An unhandled exception has occurred while executing the request.
MappyApplication.Exceptions.AppErrorResponse: Invalid token
   at MappyApplication.Repository.TokenRepository.FindByAccessToken(String accessToken) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/TokenRepository.cs:line 43
   at Program.<>c.<<Main>$>b__0_11(TokenValidatedContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 104
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerEvents.TokenValidated(TokenValidatedContext context)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.AuthenticateAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationService.AuthenticateAsync(HttpContext context, String scheme)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 05:05:23.463 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 500 null text/plain; charset=utf-8 29.6904ms
2025-11-15 05:05:36.521 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:36.562 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:36.568 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:05:36.573 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:05:36.584 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:05:36.600 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:05:36.623 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:05:36.625 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:05:36.627 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:05:36.629 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:05:36.630 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:05:36.638 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:05:36.640 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:05:36.640 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:05:36.641 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 68.0015ms
2025-11-15 05:05:36.641 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:05:36.641 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 120.1881ms
2025-11-15 05:05:37.556 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:37.585 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:37.586 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:05:37.587 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:05:37.588 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:05:37.589 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 32.2476ms
2025-11-15 05:05:39.624 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:39.649 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:39.649 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:05:39.650 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:05:39.651 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:05:39.651 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 26.9117ms
2025-11-15 05:05:40.272 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:40.300 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:40.301 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:05:40.301 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:05:40.301 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:05:40.301 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 29.6207ms
2025-11-15 05:05:40.738 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:40.765 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:40.766 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:05:40.766 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:05:40.766 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:05:40.766 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 27.8485ms
2025-11-15 05:05:41.370 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:05:41.400 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:05:41.400 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:05:41.400 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:05:41.400 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:05:41.401 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 31.0536ms
2025-11-15 05:05:48.355 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 05:05:48.359 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:05:48.360 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:05:48.437 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 05:05:48.488 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:05:48.490 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:05:48.491 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:05:48.492 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:05:48.492 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:05:48.496 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:05:48.497 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:05:48.497 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:05:48.498 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 136.8202ms
2025-11-15 05:05:48.498 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 05:05:48.498 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 143.6363ms
2025-11-15 05:06:00.014 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:06:00.044 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:00.047 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:06:00.047 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:06:00.050 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:06:00.055 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:06:00.058 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:06:00.059 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:06:00.061 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:06:00.062 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:06:00.063 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:06:00.070 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:06:00.071 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:06:00.071 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:06:00.072 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 24.0063ms
2025-11-15 05:06:00.072 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:06:00.072 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 57.8307ms
2025-11-15 05:06:08.759 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:06:08.812 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:08.813 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:06:08.814 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:06:08.830 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:06:08.836 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:06:08.843 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:06:08.853 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:06:08.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:06:08.856 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:06:08.860 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:06:08.892 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:06:08.894 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:06:08.894 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:06:08.895 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 71.9558ms
2025-11-15 05:06:08.895 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:06:08.895 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 136.0142ms
2025-11-15 05:06:12.280 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:12.288 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:06:12.288 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:06:12.288 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 8.3662ms
2025-11-15 05:06:20.095 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:20.124 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:20.125 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:06:20.125 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:06:20.126 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:06:20.126 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 31.0894ms
2025-11-15 05:06:21.590 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:21.623 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:21.624 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:06:21.624 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:06:21.625 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:06:21.625 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 34.3339ms
2025-11-15 05:06:22.287 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:22.309 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:22.310 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:06:22.310 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:06:22.310 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:06:22.310 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 23.3246ms
2025-11-15 05:06:22.889 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:22.900 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:22.900 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:06:22.900 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:06:22.900 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:06:22.900 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 11.0699ms
2025-11-15 05:06:38.927 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 05:06:38.952 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:38.953 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:06:38.953 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:06:38.955 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:06:38.957 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 05:06:38.962 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:06:38.971 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:06:38.973 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:06:38.975 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 05:06:38.977 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 05:06:38.982 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 05:06:38.983 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 05:06:38.984 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 05:06:38.984 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 31.0604ms
2025-11-15 05:06:38.984 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 05:06:38.984 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 57.9385ms
2025-11-15 05:06:52.305 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:52.335 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:52.336 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 05:06:52.340 +03:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 05:06:52.343 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 05:06:52.347 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 05:06:52.348 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 05:06:52.357 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Logout (MappyApplication) in 16.9203ms
2025-11-15 05:06:52.358 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Logout (MappyApplication)'
2025-11-15 05:06:52.358 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 200 null application/json; charset=utf-8 52.6714ms
2025-11-15 05:06:54.069 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 05:06:54.094 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 05:06:54.095 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 05:06:54.095 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 05:06:54.096 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 05:06:54.096 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 26.6792ms
2025-11-15 16:10:36.462 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mappy_db' AND TABLE_NAME='__EFMigrationsHistory';
2025-11-15 16:10:36.490 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mappy_db' AND TABLE_NAME='__EFMigrationsHistory';
2025-11-15 16:10:36.515 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-11-15 16:10:36.521 +03:00 [INF] Applying migration '20251115131023_modifyTable'.
2025-11-15 16:10:36.570 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `AspNetRoles`
WHERE `Id` = '3b6b1389-ee24-49d0-aa50-62cd73d7ac18';
SELECT ROW_COUNT();
2025-11-15 16:10:36.571 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `AspNetRoles`
WHERE `Id` = 'ef6d7c90-f563-4d7c-9a01-02121fa05bfa';
SELECT ROW_COUNT();
2025-11-15 16:10:36.589 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Cities` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `CityName` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Country` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Emoji` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Date` datetime(6) NOT NULL,
    `Notes` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Lat` int NOT NULL,
    `Lng` int NOT NULL,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_Cities` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Cities_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 16:10:36.594 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Workouts` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Type` int NOT NULL,
    `Date` datetime(6) NOT NULL,
    `Distance` float NOT NULL,
    `Duration` float NOT NULL,
    `Pace` float NOT NULL,
    `Cadence` float NOT NULL,
    `Emoji` longtext CHARACTER SET utf8mb4 NOT NULL,
    `CityName` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Coords` longtext CHARACTER SET utf8mb4 NOT NULL,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_Workouts` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Workouts_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2025-11-15 16:10:36.595 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetRoles` (`Id`, `ConcurrencyStamp`, `Name`, `NormalizedName`)
VALUES ('07182011-53b3-4671-86e5-e048f94a4c1e', NULL, 'admin', 'ADMIN'),
('cfa90116-52dc-4418-b08c-5d18431d9b78', NULL, 'user', 'USER');
2025-11-15 16:10:36.609 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Cities_UserId` ON `Cities` (`UserId`);
2025-11-15 16:10:36.614 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Workouts_UserId` ON `Workouts` (`UserId`);
2025-11-15 16:10:36.615 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20251115131023_modifyTable', '8.0.18');
2025-11-15 16:10:57.401 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:10:57.446 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:10:57.447 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:10:57.448 +03:00 [INF] Hosting environment: Development
2025-11-15 16:10:57.448 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:11:22.189 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/ - null null
2025-11-15 16:11:22.218 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:11:22.266 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/ - 404 null application/json; charset=utf-8 76.4768ms
2025-11-15 16:11:22.287 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/, Response status code: 404
2025-11-15 16:11:22.365 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/favicon.ico - null null
2025-11-15 16:11:22.368 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/favicon.ico - 404 null application/json; charset=utf-8 4.5021ms
2025-11-15 16:11:22.369 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/favicon.ico, Response status code: 404
2025-11-15 16:11:26.531 +03:00 [INF] Application is shutting down...
2025-11-15 16:26:47.634 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mappy_db' AND TABLE_NAME='__EFMigrationsHistory';
2025-11-15 16:26:47.660 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mappy_db' AND TABLE_NAME='__EFMigrationsHistory';
2025-11-15 16:26:47.667 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-11-15 16:26:47.674 +03:00 [INF] Applying migration '20251115132640_modifyTables'.
2025-11-15 16:26:47.721 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `AspNetRoles`
WHERE `Id` = '07182011-53b3-4671-86e5-e048f94a4c1e';
SELECT ROW_COUNT();
2025-11-15 16:26:47.722 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `AspNetRoles`
WHERE `Id` = 'cfa90116-52dc-4418-b08c-5d18431d9b78';
SELECT ROW_COUNT();
2025-11-15 16:26:47.731 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetRoles` (`Id`, `ConcurrencyStamp`, `Name`, `NormalizedName`)
VALUES ('06fef589-c5a2-43c5-8c18-a8defd0269ea', NULL, 'user', 'USER'),
('6d759cce-b64c-4517-ba72-68329b44c7f2', NULL, 'admin', 'ADMIN');
2025-11-15 16:26:47.731 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20251115132640_modifyTables', '8.0.18');
2025-11-15 16:26:53.962 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:26:54.011 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:26:54.012 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:26:54.012 +03:00 [INF] Hosting environment: Development
2025-11-15 16:26:54.012 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:27:05.679 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 16:27:05.746 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 68.0243ms
2025-11-15 16:27:05.922 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:27:05.987 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "DELETE api/v1/Cities/{id}" for actions - MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication),MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication). Actions require a unique method/path combination for Swagger/OpenAPI 3.0. Use ConflictingActionsResolver as a workaround
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperations(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePaths(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerDocumentWithoutFilters(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 16:27:05.996 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 74.0976ms
2025-11-15 16:27:11.975 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - null null
2025-11-15 16:27:11.984 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:27:12.043 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - 404 null application/json; charset=utf-8 68.1098ms
2025-11-15 16:27:12.044 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-11-15 16:27:58.101 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 16:27:58.110 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 8.6528ms
2025-11-15 16:27:58.159 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - null null
2025-11-15 16:27:58.189 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - 404 null application/json; charset=utf-8 30.2257ms
2025-11-15 16:27:58.190 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-11-15 16:27:58.418 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:27:58.431 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "DELETE api/v1/Cities/{id}" for actions - MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication),MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication). Actions require a unique method/path combination for Swagger/OpenAPI 3.0. Use ConflictingActionsResolver as a workaround
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperations(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePaths(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerDocumentWithoutFilters(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 16:27:58.432 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 13.7542ms
2025-11-15 16:28:06.182 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 16:28:06.185 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 3.962ms
2025-11-15 16:28:06.216 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - null null
2025-11-15 16:28:06.243 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - 404 null application/json; charset=utf-8 26.4987ms
2025-11-15 16:28:06.243 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-11-15 16:28:06.434 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:28:06.441 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "DELETE api/v1/Cities/{id}" for actions - MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication),MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication). Actions require a unique method/path combination for Swagger/OpenAPI 3.0. Use ConflictingActionsResolver as a workaround
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperations(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePaths(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerDocumentWithoutFilters(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 16:28:06.442 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 7.7397ms
2025-11-15 16:29:26.988 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 16:29:26.994 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 6.4786ms
2025-11-15 16:29:27.024 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - null null
2025-11-15 16:29:27.055 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - 404 null application/json; charset=utf-8 31.1771ms
2025-11-15 16:29:27.056 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-11-15 16:29:27.246 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:29:27.254 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "DELETE api/v1/Cities/{id}" for actions - MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication),MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication). Actions require a unique method/path combination for Swagger/OpenAPI 3.0. Use ConflictingActionsResolver as a workaround
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperations(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePaths(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerDocumentWithoutFilters(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-15 16:29:27.255 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 9.0687ms
2025-11-15 16:29:30.064 +03:00 [INF] Application is shutting down...
2025-11-15 16:29:33.214 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:29:33.273 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:29:33.274 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:29:33.275 +03:00 [INF] Hosting environment: Development
2025-11-15 16:29:33.275 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:29:34.595 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 16:29:34.643 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 48.1257ms
2025-11-15 16:29:34.674 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - null null
2025-11-15 16:29:34.681 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:29:34.716 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json - 404 null application/json; charset=utf-8 42.7304ms
2025-11-15 16:29:34.717 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:8080/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-11-15 16:29:34.880 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:29:34.930 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 49.6492ms
2025-11-15 16:32:31.426 +03:00 [INF] Application is shutting down...
2025-11-15 16:32:34.398 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:32:34.445 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:32:34.446 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:32:34.446 +03:00 [INF] Hosting environment: Development
2025-11-15 16:32:34.446 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:32:35.977 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/index.html - null null
2025-11-15 16:32:36.027 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/index.html - 200 null text/html;charset=utf-8 50.5411ms
2025-11-15 16:32:36.139 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:32:36.200 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 61.2775ms
2025-11-15 16:33:55.887 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - null null
2025-11-15 16:33:55.913 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 26.0739ms
2025-11-15 16:35:52.571 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 167
2025-11-15 16:35:52.591 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:35:52.661 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 16:35:52.684 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:35:53.348 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:35:53.378 +03:00 [ERR] Email address already exists
MappyApplication.Exceptions.AppErrorResponse: Email address already exists
   at MappyApplication.Repository.AuthManager.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 45
2025-11-15 16:35:53.386 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 699.9854ms
2025-11-15 16:35:53.386 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 16:35:53.386 +03:00 [ERR] An error occured
MappyApplication.Exceptions.AppErrorResponse: Email address already exists
   at MappyApplication.Repository.AuthManager.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/AuthManager.cs:line 58
   at MappyApplication.Controllers.AuthController.Register(AuthRegister authRegister) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/AuthController.cs:line 24
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 140
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 16:35:53.396 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 400 null application/json; charset=utf-8 824.9502ms
2025-11-15 16:35:59.813 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - application/json 168
2025-11-15 16:35:59.822 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 16:35:59.822 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Register(MappyApplication.Models.user.AuthRegister) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:35:59.894 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:35:59.951 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedUserName` = @__normalizedUserName_0
LIMIT 1
2025-11-15 16:35:59.952 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:36:00.003 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Size = 256), @p4='?' (DbType = Boolean), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Boolean), @p8='?' (DbType = DateTimeOffset), @p9='?' (Size = 256), @p10='?' (Size = 256), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 4000), @p15='?' (DbType = Boolean), @p16='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetUsers` (`Id`, `AccessFailedCount`, `ConcurrencyStamp`, `Email`, `EmailConfirmed`, `FirstName`, `LastName`, `LockoutEnabled`, `LockoutEnd`, `NormalizedEmail`, `NormalizedUserName`, `PasswordHash`, `PhoneNumber`, `PhoneNumberConfirmed`, `SecurityStamp`, `TwoFactorEnabled`, `UserName`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
2025-11-15 16:36:00.011 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-11-15 16:36:00.024 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255), @__p_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`UserId`, `a`.`RoleId`
FROM `AspNetUserRoles` AS `a`
WHERE (`a`.`UserId` = @__p_0) AND (`a`.`RoleId` = @__p_1)
LIMIT 1
2025-11-15 16:36:00.025 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-11-15 16:36:00.030 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedUserName` = @__normalizedUserName_0
LIMIT 1
2025-11-15 16:36:00.031 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:36:00.050 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 255), @p18='?' (Size = 255), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p19='?' (Size = 4000), @p4='?' (Size = 256), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTimeOffset), @p10='?' (Size = 256), @p11='?' (Size = 256), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetUserRoles` (`RoleId`, `UserId`)
VALUES (@p0, @p1);
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p2, `ConcurrencyStamp` = @p3, `Email` = @p4, `EmailConfirmed` = @p5, `FirstName` = @p6, `LastName` = @p7, `LockoutEnabled` = @p8, `LockoutEnd` = @p9, `NormalizedEmail` = @p10, `NormalizedUserName` = @p11, `PasswordHash` = @p12, `PhoneNumber` = @p13, `PhoneNumberConfirmed` = @p14, `SecurityStamp` = @p15, `TwoFactorEnabled` = @p16, `UserName` = @p17
WHERE `Id` = @p18 AND `ConcurrencyStamp` = @p19;
SELECT ROW_COUNT();
2025-11-15 16:36:00.068 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:36:00.087 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:00.094 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:00.102 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:00.103 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:00.123 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:36:00.128 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:36:00.146 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-11-15 16:36:00.162 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:36:00.168 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:36:00.174 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Register (MappyApplication) in 351.0464ms
2025-11-15 16:36:00.174 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Register (MappyApplication)'
2025-11-15 16:36:00.174 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/register - 200 null application/json; charset=utf-8 361.5399ms
2025-11-15 16:36:18.571 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 16:36:18.592 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:36:18.603 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:36:18.696 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:36:18.741 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:36:18.743 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:18.744 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:18.745 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:18.745 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:18.749 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:36:18.750 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:36:18.752 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:36:18.753 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:36:18.753 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 149.787ms
2025-11-15 16:36:18.753 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:36:18.753 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 184.0342ms
2025-11-15 16:36:19.468 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 16:36:19.469 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:36:19.469 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:36:19.493 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:36:19.554 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:36:19.556 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:19.557 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:19.557 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:19.558 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:19.560 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:36:19.561 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:36:19.562 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:36:19.562 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:36:19.562 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 93.238ms
2025-11-15 16:36:19.563 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:36:19.563 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 94.855ms
2025-11-15 16:36:20.150 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 16:36:20.150 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:36:20.150 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:36:20.174 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:36:20.232 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:36:20.233 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:20.233 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:20.234 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:20.234 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:20.236 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:36:20.237 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:36:20.240 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:36:20.240 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:36:20.240 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 89.5932ms
2025-11-15 16:36:20.240 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:36:20.240 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 90.6414ms
2025-11-15 16:36:24.574 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:36:24.581 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:36:24.585 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:36:24.586 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 11.898ms
2025-11-15 16:36:25.466 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:36:25.470 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:36:25.471 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:36:25.471 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 5.0874ms
2025-11-15 16:36:41.884 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:36:41.959 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:36:41.964 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 16:36:41.966 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:36:41.971 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 16:36:41.976 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:36:41.988 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:36:41.990 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:41.992 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:41.993 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:36:41.994 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:36:41.996 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:36:41.997 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:36:41.999 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:36:42.000 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:36:42.000 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 34.2372ms
2025-11-15 16:36:42.000 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 16:36:42.000 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 116.6024ms
2025-11-15 16:36:43.090 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:36:43.123 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:36:43.125 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:36:43.125 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:36:43.128 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:36:43.128 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 38.675ms
2025-11-15 16:37:11.429 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:37:11.478 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:37:11.480 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:37:11.480 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:37:11.481 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:37:11.481 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 52.1882ms
2025-11-15 16:37:38.777 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:37:38.779 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:37:38.780 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:37:38.780 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 2.4276ms
2025-11-15 16:37:46.825 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:37:46.847 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:37:46.847 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:37:46.847 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:37:46.847 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:37:46.847 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 22.7026ms
2025-11-15 16:37:49.575 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 16:37:49.576 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:37:49.577 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:37:49.603 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:37:49.662 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:37:49.664 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:37:49.665 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:37:49.666 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:37:49.666 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:37:49.668 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:37:49.669 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:37:49.671 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:37:49.671 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:37:49.671 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 94.1685ms
2025-11-15 16:37:49.671 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:37:49.671 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 96.739ms
2025-11-15 16:38:00.310 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:38:00.336 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:38:00.337 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.GetAll (MappyApplication)'
2025-11-15 16:38:00.340 +03:00 [INF] Route matched with {action = "GetAll", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.Collections.Generic.IEnumerable`1[MappyApplication.Models.cities.CitiesDto]] GetAll() on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:38:00.345 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
2025-11-15 16:38:00.351 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[MappyApplication.Models.cities.CitiesDto, MappyApplication, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-15 16:38:00.357 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.GetAll (MappyApplication) in 17.085ms
2025-11-15 16:38:00.357 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.GetAll (MappyApplication)'
2025-11-15 16:38:00.357 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 200 null application/json; charset=utf-8 47.0637ms
2025-11-15 16:38:06.210 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 1978
2025-11-15 16:38:06.211 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:38:06.211 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:38:06.212 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 2.092ms
2025-11-15 16:38:09.989 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 1978
2025-11-15 16:38:10.028 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:38:10.030 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:38:10.034 +03:00 [INF] Route matched with {action = "AddAsynch", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddAsynch(MappyApplication.Data.Cities) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:38:10.063 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-11-15 16:38:10.074 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication) in 40.2809ms
2025-11-15 16:38:10.074 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:38:10.074 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 400 null application/problem+json; charset=utf-8 84.73ms
2025-11-15 16:38:45.609 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 159
2025-11-15 16:38:45.639 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:38:45.639 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:38:45.639 +03:00 [INF] Route matched with {action = "AddAsynch", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddAsynch(MappyApplication.Data.Cities) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:38:45.640 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-11-15 16:38:45.640 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication) in 1.1185ms
2025-11-15 16:38:45.640 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:38:45.641 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 400 null application/problem+json; charset=utf-8 31.5956ms
2025-11-15 16:39:45.117 +03:00 [INF] Application is shutting down...
2025-11-15 16:39:48.198 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:39:48.249 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:39:48.250 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:39:48.250 +03:00 [INF] Hosting environment: Development
2025-11-15 16:39:48.250 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:39:51.891 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 16:39:51.904 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:39:52.450 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:39:52.469 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:39:52.470 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:39:52.493 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:39:52.496 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 605.2676ms
2025-11-15 16:39:54.116 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - null null
2025-11-15 16:39:54.158 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:39:54.158 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:39:54.159 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:39:54.160 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:39:54.160 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Auth/logout - 401 null application/json; charset=utf-8 44.3824ms
2025-11-15 16:39:57.746 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - application/json 61
2025-11-15 16:39:57.756 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:39:57.781 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] Login(MappyApplication.Models.user.AuthLogin) on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:39:57.882 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`NormalizedEmail` = @__normalizedEmail_0
LIMIT 2
2025-11-15 16:39:57.945 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:39:57.967 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:39:57.973 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:39:57.978 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:39:57.979 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:39:58.021 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:39:58.031 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:39:58.049 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-11-15 16:39:58.054 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:39:58.060 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:39:58.069 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.Login (MappyApplication) in 286.7305ms
2025-11-15 16:39:58.069 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.Login (MappyApplication)'
2025-11-15 16:39:58.070 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/login - 200 null application/json; charset=utf-8 323.4275ms
2025-11-15 16:40:07.868 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 159
2025-11-15 16:40:07.946 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:40:07.947 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:40:07.949 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:40:07.950 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:40:07.950 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 82.8675ms
2025-11-15 16:40:24.749 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 159
2025-11-15 16:40:24.822 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:40:24.831 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:40:24.848 +03:00 [INF] Route matched with {action = "AddAsynch", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddAsynch(MappyApplication.Data.Cities) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:40:24.909 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:40:24.932 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication) in 83.9885ms
2025-11-15 16:40:24.932 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:40:24.933 +03:00 [ERR] An error occured
System.InvalidOperationException: The instance of entity type 'User' cannot be tracked because another instance with the same key value for {'Id'} is already being tracked. When attaching existing entities, ensure that only one entity instance with a given key value is attached. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the conflicting key values.
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.ThrowIdentityConflict(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry, Boolean updateDuplicate)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityStateAsync(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintActionAsync(EntityEntryGraphNode`1 node, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraphAsync(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.AddAsync(TEntity entity, CancellationToken cancellationToken)
   at MappyApplication.Repository.GenricRepository`1.AddAsync(T e) in /Users/salah/Desktop/MappyApplication/MappyApplication/Repository/GenricRepository.cs:line 53
   at MappyApplication.Controllers.CitiesController.AddAsynch(Cities cities) in /Users/salah/Desktop/MappyApplication/MappyApplication/Controllers/CitiesController.cs:line 74
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in /Users/salah/Desktop/MappyApplication/MappyApplication/Program.cs:line 140
--- End of stack trace from previous location ---
   at MappyApplication.MiddleWare.ExceptionMiddleWare.InvokeAsync(HttpContext ctx) in /Users/salah/Desktop/MappyApplication/MappyApplication/MiddleWare/ExceptionMiddleWare.cs:line 21
2025-11-15 16:40:24.950 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 500 null application/json; charset=utf-8 201.9881ms
2025-11-15 16:42:15.578 +03:00 [INF] Application is shutting down...
2025-11-15 16:42:18.762 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:42:18.809 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:42:18.810 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:42:18.810 +03:00 [INF] Hosting environment: Development
2025-11-15 16:42:18.810 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:42:26.733 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 159
2025-11-15 16:42:26.752 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:42:27.265 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:42:27.286 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:42:27.292 +03:00 [INF] Route matched with {action = "AddAsynch", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddAsynch(MappyApplication.Data.Cities) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:42:27.365 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:42:27.446 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (Size = 4000), @p7='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Cities` (`CityName`, `Country`, `Date`, `Emoji`, `Lat`, `Lng`, `Notes`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `Cities`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:42:27.460 +03:00 [INF] Added Cities MappyApplication.Data.Cities
2025-11-15 16:42:27.462 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:42:27.471 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication) in 177.7594ms
2025-11-15 16:42:27.472 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:42:27.475 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 200 null application/json; charset=utf-8 743.4022ms
2025-11-15 16:42:45.644 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Cities - application/json 159
2025-11-15 16:42:45.692 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:42:45.695 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:42:45.696 +03:00 [INF] Route matched with {action = "AddAsynch", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddAsynch(MappyApplication.Data.Cities) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:42:45.705 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:42:45.715 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (Size = 4000), @p7='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Cities` (`CityName`, `Country`, `Date`, `Emoji`, `Lat`, `Lng`, `Notes`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `Cities`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:42:45.717 +03:00 [INF] Added Cities MappyApplication.Data.Cities
2025-11-15 16:42:45.718 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:42:45.718 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication) in 21.5701ms
2025-11-15 16:42:45.718 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.AddAsynch (MappyApplication)'
2025-11-15 16:42:45.718 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Cities - 200 null application/json; charset=utf-8 74.5891ms
2025-11-15 16:43:04.357 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:43:04.448 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:43:04.449 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:43:04.450 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:43:04.459 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:43:04.459 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 102.0124ms
2025-11-15 16:43:09.874 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:43:09.884 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
 ---> System.ArgumentException: IDX14102: Unable to decode the header '[PII of type 'Microsoft.IdentityModel.Logging.SecurityArtifact' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]' as Base64Url encoded string.
 ---> System.FormatException: IDX10400: Unable to decode: '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]' as Base64url encoded string.
   at Microsoft.IdentityModel.Tokens.Base64UrlEncoder.UnsafeDecode(ReadOnlyMemory`1 str)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   --- End of inner exception stack trace ---
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken..ctor(String jwtEncodedString)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ReadToken(String token, TokenValidationParameters validationParameters)
   --- End of inner exception stack trace ---
2025-11-15 16:43:09.892 +03:00 [INF] Bearer was not authenticated. Failure message: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
2025-11-15 16:43:09.893 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:43:09.894 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:43:09.894 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 19.7967ms
2025-11-15 16:43:20.513 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:43:20.516 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
 ---> System.ArgumentException: IDX14102: Unable to decode the header '[PII of type 'Microsoft.IdentityModel.Logging.SecurityArtifact' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]' as Base64Url encoded string.
 ---> System.FormatException: IDX10400: Unable to decode: '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]' as Base64url encoded string.
   at Microsoft.IdentityModel.Tokens.Base64UrlEncoder.UnsafeDecode(ReadOnlyMemory`1 str)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   --- End of inner exception stack trace ---
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken..ctor(String jwtEncodedString)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ReadToken(String token, TokenValidationParameters validationParameters)
   --- End of inner exception stack trace ---
2025-11-15 16:43:20.516 +03:00 [INF] Bearer was not authenticated. Failure message: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
2025-11-15 16:43:20.517 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:43:20.517 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:43:20.517 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 401 null application/json; charset=utf-8 3.6522ms
2025-11-15 16:43:38.429 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities - null null
2025-11-15 16:43:38.461 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:43:38.461 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.GetAll (MappyApplication)'
2025-11-15 16:43:38.466 +03:00 [INF] Route matched with {action = "GetAll", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.Collections.Generic.IEnumerable`1[MappyApplication.Models.cities.CitiesDto]] GetAll() on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:43:38.483 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
2025-11-15 16:43:38.490 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[MappyApplication.Models.cities.CitiesDto, MappyApplication, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-15 16:43:38.498 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.GetAll (MappyApplication) in 31.5508ms
2025-11-15 16:43:38.498 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.GetAll (MappyApplication)'
2025-11-15 16:43:38.498 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities - 200 null application/json; charset=utf-8 68.9949ms
2025-11-15 16:43:49.566 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities/1 - null null
2025-11-15 16:43:49.568 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:43:49.568 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:43:49.568 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities/1 - 401 null application/json; charset=utf-8 2.4469ms
2025-11-15 16:43:56.569 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities/1 - null null
2025-11-15 16:43:56.592 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:43:56.592 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.GetById (MappyApplication)'
2025-11-15 16:43:56.596 +03:00 [INF] Route matched with {action = "GetById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.cities.CitiesDto] GetById(Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:43:56.605 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:43:56.606 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.cities.CitiesDto'.
2025-11-15 16:43:56.607 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.GetById (MappyApplication) in 10.831ms
2025-11-15 16:43:56.607 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.GetById (MappyApplication)'
2025-11-15 16:43:56.607 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities/1 - 200 null application/json; charset=utf-8 38.5099ms
2025-11-15 16:43:59.202 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Cities/2 - null null
2025-11-15 16:43:59.228 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:43:59.228 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.GetById (MappyApplication)'
2025-11-15 16:43:59.229 +03:00 [INF] Route matched with {action = "GetById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.cities.CitiesDto] GetById(Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:43:59.230 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:43:59.230 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.cities.CitiesDto'.
2025-11-15 16:43:59.231 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.GetById (MappyApplication) in 2.0097ms
2025-11-15 16:43:59.231 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.GetById (MappyApplication)'
2025-11-15 16:43:59.231 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Cities/2 - 200 null application/json; charset=utf-8 28.7948ms
2025-11-15 16:44:17.984 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - application/json 20
2025-11-15 16:44:17.988 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:44:17.989 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:44:17.989 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - 401 null application/json; charset=utf-8 5.4617ms
2025-11-15 16:44:27.111 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - application/json 20
2025-11-15 16:44:27.165 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:44:27.167 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:44:27.174 +03:00 [INF] Route matched with {action = "UpdateById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateById(MappyApplication.Models.cities.CitiesUpdate, Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:44:27.179 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-11-15 16:44:27.191 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication) in 17.2576ms
2025-11-15 16:44:27.191 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:44:27.192 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - 400 null application/problem+json; charset=utf-8 80.2883ms
2025-11-15 16:45:14.949 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - application/json 153
2025-11-15 16:45:15.013 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:45:15.015 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:45:15.016 +03:00 [INF] Route matched with {action = "UpdateById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateById(MappyApplication.Models.cities.CitiesUpdate, Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:45:15.279 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:45:15.281 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:45:15.281 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication) in 11.9091ms
2025-11-15 16:45:15.281 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:45:15.281 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - 200 null application/json; charset=utf-8 332.7897ms
2025-11-15 16:45:57.856 +03:00 [INF] Application is shutting down...
2025-11-15 16:46:01.455 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:46:01.504 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:46:01.505 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:46:01.505 +03:00 [INF] Hosting environment: Development
2025-11-15 16:46:01.505 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:46:03.524 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - application/json 153
2025-11-15 16:46:03.542 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:46:04.056 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:46:04.077 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:46:04.084 +03:00 [INF] Route matched with {action = "UpdateById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateById(MappyApplication.Models.cities.CitiesUpdate, Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:46:04.157 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:46:04.167 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:46:04.176 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication) in 91.4223ms
2025-11-15 16:46:04.177 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:46:04.180 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - 200 null application/json; charset=utf-8 656.8475ms
2025-11-15 16:46:48.974 +03:00 [INF] Application is shutting down...
2025-11-15 16:46:51.534 +03:00 [INF] User profile is available. Using '/Users/salah/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-11-15 16:46:51.586 +03:00 [INF] Now listening on: http://localhost:8080
2025-11-15 16:46:51.589 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-15 16:46:51.589 +03:00 [INF] Hosting environment: Development
2025-11-15 16:46:51.589 +03:00 [INF] Content root path: /Users/salah/Desktop/MappyApplication/MappyApplication
2025-11-15 16:46:53.823 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - application/json 153
2025-11-15 16:46:53.844 +03:00 [WRN] Failed to determine the https port for redirect.
2025-11-15 16:46:54.357 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:46:54.378 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:46:54.384 +03:00 [INF] Route matched with {action = "UpdateById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateById(MappyApplication.Models.cities.CitiesUpdate, Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:46:54.454 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:46:54.514 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@p8='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (Size = 4000), @p7='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cities` SET `CityName` = @p0, `Country` = @p1, `Date` = @p2, `Emoji` = @p3, `Lat` = @p4, `Lng` = @p5, `Notes` = @p6, `UserId` = @p7
WHERE `Id` = @p8;
SELECT ROW_COUNT();
2025-11-15 16:46:54.517 +03:00 [INF] Updated Cities MappyApplication.Data.Cities
2025-11-15 16:46:54.519 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:46:54.528 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication) in 143.2846ms
2025-11-15 16:46:54.529 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.UpdateById (MappyApplication)'
2025-11-15 16:46:54.532 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:8080/api/v1/Cities/2 - 200 null application/json; charset=utf-8 709.5505ms
2025-11-15 16:47:13.655 +03:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:8080/api/v1/Cities/2 - null null
2025-11-15 16:47:13.665 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:47:13.677 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:47:13.678 +03:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:8080/api/v1/Cities/2 - 401 null application/json; charset=utf-8 22.3537ms
2025-11-15 16:47:35.751 +03:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:8080/api/v1/Cities/2 - null null
2025-11-15 16:47:35.816 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:47:35.818 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication)'
2025-11-15 16:47:35.822 +03:00 [INF] Route matched with {action = "DeleteById", controller = "Cities"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] DeleteById(Int32) on controller MappyApplication.Controllers.CitiesController (MappyApplication).
2025-11-15 16:47:35.830 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM `Cities` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:47:35.841 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
DELETE FROM `Cities`
WHERE `Id` = @p0;
SELECT ROW_COUNT();
2025-11-15 16:47:35.844 +03:00 [INF] Deleted Cities MappyApplication.Data.Cities
2025-11-15 16:47:35.844 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:47:35.845 +03:00 [INF] Executed action MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication) in 22.6807ms
2025-11-15 16:47:35.845 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.CitiesController.DeleteById (MappyApplication)'
2025-11-15 16:47:35.845 +03:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:8080/api/v1/Cities/2 - 200 null application/json; charset=utf-8 93.7405ms
2025-11-15 16:47:58.855 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Workouts - null null
2025-11-15 16:47:58.930 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:47:58.933 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.WorkoutsController.GetAll (MappyApplication)'
2025-11-15 16:47:58.936 +03:00 [INF] Route matched with {action = "GetAll", controller = "Workouts"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.Collections.Generic.IEnumerable`1[MappyApplication.Models.workouts.WorkoutsDto]] GetAll() on controller MappyApplication.Controllers.WorkoutsController (MappyApplication).
2025-11-15 16:47:58.949 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`
FROM `Workouts` AS `w`
2025-11-15 16:47:58.954 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[MappyApplication.Models.workouts.WorkoutsDto, MappyApplication, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-15 16:47:58.963 +03:00 [INF] Executed action MappyApplication.Controllers.WorkoutsController.GetAll (MappyApplication) in 27.3407ms
2025-11-15 16:47:58.964 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.WorkoutsController.GetAll (MappyApplication)'
2025-11-15 16:47:58.964 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Workouts - 200 null application/json; charset=utf-8 108.7307ms
2025-11-15 16:48:28.690 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Workouts - application/json 280
2025-11-15 16:48:28.692 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:48:28.692 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:48:28.693 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Workouts - 401 null application/json; charset=utf-8 2.216ms
2025-11-15 16:48:35.861 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Workouts - application/json 280
2025-11-15 16:48:35.905 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:48:35.909 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.WorkoutsController.AddAsynch (MappyApplication)'
2025-11-15 16:48:35.918 +03:00 [INF] Route matched with {action = "AddAsynch", controller = "Workouts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddAsynch(MappyApplication.Data.Workouts) on controller MappyApplication.Controllers.WorkoutsController (MappyApplication).
2025-11-15 16:48:35.965 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:48:36.010 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Single), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (DbType = Single), @p6='?' (DbType = Single), @p7='?' (Size = 4000), @p8='?' (DbType = Single), @p9='?' (DbType = Int32), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `Workouts` (`Id`, `Cadence`, `CityName`, `Coords`, `Date`, `Distance`, `Duration`, `Emoji`, `Pace`, `Type`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-11-15 16:48:36.011 +03:00 [INF] Added Workouts MappyApplication.Data.Workouts
2025-11-15 16:48:36.011 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-15 16:48:36.011 +03:00 [INF] Executed action MappyApplication.Controllers.WorkoutsController.AddAsynch (MappyApplication) in 93.0585ms
2025-11-15 16:48:36.011 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.WorkoutsController.AddAsynch (MappyApplication)'
2025-11-15 16:48:36.011 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Workouts - 200 null application/json; charset=utf-8 150.9243ms
2025-11-15 16:48:39.661 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:8080/api/v1/Workouts - null null
2025-11-15 16:48:39.688 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:48:39.688 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.WorkoutsController.GetAll (MappyApplication)'
2025-11-15 16:48:39.689 +03:00 [INF] Route matched with {action = "GetAll", controller = "Workouts"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.Collections.Generic.IEnumerable`1[MappyApplication.Models.workouts.WorkoutsDto]] GetAll() on controller MappyApplication.Controllers.WorkoutsController (MappyApplication).
2025-11-15 16:48:39.692 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`
FROM `Workouts` AS `w`
2025-11-15 16:48:39.696 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[MappyApplication.Models.workouts.WorkoutsDto, MappyApplication, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-15 16:48:39.700 +03:00 [INF] Executed action MappyApplication.Controllers.WorkoutsController.GetAll (MappyApplication) in 11.6337ms
2025-11-15 16:48:39.701 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.WorkoutsController.GetAll (MappyApplication)'
2025-11-15 16:48:39.701 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:8080/api/v1/Workouts - 200 null application/json; charset=utf-8 39.9593ms
2025-11-15 16:48:47.292 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:48:47.321 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:48:47.322 +03:00 [INF] Bearer was not authenticated. Failure message: Invalid token
2025-11-15 16:48:47.322 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-11-15 16:48:47.324 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-11-15 16:48:47.324 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 401 null application/json; charset=utf-8 31.3379ms
2025-11-15 16:48:52.911 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - null 0
2025-11-15 16:48:52.943 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__accessToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`AccessToken` = @__accessToken_0
LIMIT 2
2025-11-15 16:48:52.943 +03:00 [INF] Executing endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 16:48:52.946 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[MappyApplication.Models.user.AuthResponse] RefreshToken() on controller MappyApplication.Controllers.AuthController (MappyApplication).
2025-11-15 16:48:52.951 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessToken`, `t`.`CreatedAt`, `t`.`DeviceId`, `t`.`Expired`, `t`.`RefreshToken`, `t`.`Revoked`, `t`.`UserId`
FROM `Tokens` AS `t`
WHERE `t`.`RefreshToken` = @__refreshToken_0
LIMIT 2
2025-11-15 16:48:52.953 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
FROM `AspNetUsers` AS `a`
WHERE `a`.`Id` = @__p_0
LIMIT 1
2025-11-15 16:48:52.970 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']

        UPDATE TOKENS
        SET Revoked = true, Expired = true
        WHERE UserId = @p0
          AND DeviceId = @p1
          AND Revoked = false
          AND Expired = false
2025-11-15 16:48:52.997 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:48:53.004 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:48:53.010 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-11-15 16:48:53.011 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ClaimType`, `a`.`ClaimValue`, `a`.`UserId`
FROM `AspNetUserClaims` AS `a`
WHERE `a`.`UserId` = @__user_Id_0
2025-11-15 16:48:53.023 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Tokens` (`AccessToken`, `CreatedAt`, `DeviceId`, `Expired`, `RefreshToken`, `Revoked`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
SELECT `Id`
FROM `Tokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-15 16:48:53.032 +03:00 [INF] Added Token MappyApplication.Data.Token
2025-11-15 16:48:53.049 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-11-15 16:48:53.054 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_Id_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`FirstName`, `t`.`LastName`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `w`.`Id`, `w`.`Cadence`, `w`.`CityName`, `w`.`Coords`, `w`.`Date`, `w`.`Distance`, `w`.`Duration`, `w`.`Emoji`, `w`.`Pace`, `w`.`Type`, `w`.`UserId`, `c`.`Id`, `c`.`CityName`, `c`.`Country`, `c`.`Date`, `c`.`Emoji`, `c`.`Lat`, `c`.`Lng`, `c`.`Notes`, `c`.`UserId`
FROM (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`FirstName`, `a`.`LastName`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Id` = @__user_Id_0
    LIMIT 2
) AS `t`
LEFT JOIN `Workouts` AS `w` ON `t`.`Id` = `w`.`UserId`
LEFT JOIN `Cities` AS `c` ON `t`.`Id` = `c`.`UserId`
ORDER BY `t`.`Id`, `w`.`Id`
2025-11-15 16:48:53.057 +03:00 [INF] Executing ObjectResult, writing value of type 'MappyApplication.Models.user.AuthResponse'.
2025-11-15 16:48:53.058 +03:00 [INF] Executed action MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication) in 112.1026ms
2025-11-15 16:48:53.058 +03:00 [INF] Executed endpoint 'MappyApplication.Controllers.AuthController.RefreshToken (MappyApplication)'
2025-11-15 16:48:53.058 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:8080/api/v1/Auth/refresh-token - 200 null application/json; charset=utf-8 147.3598ms
